/*
 *
 */

import aQute.bnd.gradle.TestOSGi

plugins {
	id 'biz.aQute.bnd.builder'
}

version = '1.0.0'

java {
	testResultsDir = layout.buildDirectory.dir('testing-results')
}

repositories {
	mavenLocal().metadataSources { mavenPom(); artifact() }
	mavenCentral()
}

dependencies {
	implementation "biz.aQute.bnd:biz.aQute.junit:${bnd_version}"
	runtimeOnly 'org.eclipse.platform:org.eclipse.osgi:3.18.100'
}

def jarTask = tasks.named('jar', Jar)

def testosgiIgnoreFailTask = tasks.register('testosgiIgnoreFail', TestOSGi) {
	description = "OSGi Test ${name}.bndrun"
	inputs.files jarTask
	bndrun = file("${name}.bndrun")
	ignoreFailures = true
}

def testosgiFailTask = tasks.register('testosgiFail', TestOSGi) {
	description = "OSGi Test ${name}.bndrun"
	inputs.files jarTask
	bndrun = file("${name}.bndrun")
	ignoreFailures = false
	resultsDirectory = layout.buildDirectory.dir("${name}-results")
}

tasks.named('check') {
	dependsOn testosgiIgnoreFailTask, testosgiFailTask
}
