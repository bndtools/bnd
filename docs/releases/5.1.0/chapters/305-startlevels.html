<!DOCTYPE html>
<html lang="en" ng-app="jpm">

	<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="/releases/5.1.0/css/style.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="/js/releases.js"></script>
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Startlevels</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Startlevels" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="One of the primary authors of bnd has always objected to startlevels. His motivation was twofold:" />
<meta property="og:description" content="One of the primary authors of bnd has always objected to startlevels. His motivation was twofold:" />
<script type="application/ld+json">
{"url":"/releases/5.1.0/chapters/305-startlevels.html","headline":"Startlevels","description":"One of the primary authors of bnd has always objected to startlevels. His motivation was twofold:","@type":"WebPage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	
		<style>
			 body {
				counter-reset: h1 20;
			}
		</style>
	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

</head>


<body>

	
<ul class="container12 menu-bar">
	<li span=11><a class=menu-link href="/releases/5.1.0/"><img
			class=menu-logo src="/releases/5.1.0/img/bnd-80x40-white.png"></a>
			<a href="/releases/5.1.0/chapters/110-introduction.html">Intro
			</a><a href="/releases/5.1.0/chapters/800-headers.html">Headers
			</a><a href="/releases/5.1.0/chapters/825-instructions-ref.html">Instructions
			</a><a href="/releases/5.1.0/chapters/855-macros-ref.html">Macros
			</a><a href="/releases/5.1.0/chapters/400-commands.html">Commands
			</a><div class="releases"><button class="dropbtn">5.1.0</button><div class="dropdown-content"></div></div>
	<li class=menu-link span=1>
			<a href="https://github.com/bndtools/bnd" target="_"><img
	style="position:absolute;top:0;right:0;margin:0;padding:0;z-index:100"
	src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67"
	alt="Fork me on GitHub"
	data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
</ul>


					

	<ul class=container12>
		<li span=3>
			<div>
			<ul class="side-nav">
	
		
			<li><a href="/releases/5.1.0/chapters/110-introduction.html">Introduction</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/120-install.html">How to install bnd</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/123-tour-workspace.html">Guided Tour</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/125-tour-features.html">Guided Tour Workspace & Projects</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/130-concepts.html">Concepts</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/140-best-practices.html">Best practices</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/150-build.html">Build</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/155-project-setup.html">Project Setup</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/160-jars.html">Generating JARs</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/170-versioning.html">Versioning</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/180-baselining.html">Baselining</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/200-components.html">Service Components</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/210-metatype.html">Metatype</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/220-contracts.html">Contracts</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/230-manifest-annotations.html">Bundle Annotations</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/235-accessor-properties.html">Accessor Properties</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/240-spi-annotations.html">SPI Annotations</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/250-resolving.html">Resolving Dependencies</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/300-launching.html">Launching</a>
	  	
  	
		
			<li class=selected>Startlevels
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/310-testing.html">Testing</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/315-launchpad-testing.html">Testing with Launchpad</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/320-packaging.html">Packaging Applications</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/330-jpms.html">JPMS Libraries</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/390-wrapping.html">Wrapping Libraries to OSGi Bundles</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/395-generating-documentation.html">Generating Documentation</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/400-commands.html">Commands</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/600-developer.html">For Developers</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/650-windows.html">Tips for Windows users</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/700-tools.html">Tools bound to bnd</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/800-headers.html">Headers</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/820-instructions.html">Instruction Reference</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/825-instructions-ref.html">Instruction Index</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/850-macros.html">Macro Reference</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/855-macros-ref.html">Macro Index</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/870-plugins.html">Plugins</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/875-external-plugins.html">External Plugins</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/880-settings.html">Settings</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/900-errors.html">Errors</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/910-warnings.html">Warnings</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/920-faq.html">Frequently Asked Questions</a>
	  	
  	
</ul>

			</div>
			
		<li span=9>
			<div class=notes-margin>
				<h1> Startlevels</h1>
				<p>One of the primary authors of bnd has always objected to startlevels. His motivation was twofold:</p>

<ul>
  <li>A dynamic OSGi system should be ablet to startup in any order. Startlevels are often abused to hide bundles
that do not handle their dynamic dependencies correctly. Hiding these bugs by controlling the start ordering
is dangerous since it removes the symptom but the cause can still bite at a later inconvenient time.</li>
  <li>Start levels are global data about a set of bundles. OSGi is quite elegant that it stores virtually all
meta data inside the bundle, not requiring global information. However, for start levels you need 
data outside the bundles. This often becomes wrong over time.</li>
</ul>

<p>With this disclaimer out of the way, there are actually cases where startlevels are quite important to 
improve the non-functional aspects.</p>

<ul>
  <li>Jojo – Declarative services provides an elegant model to build components. However, they usually depend on
configuration. If the component is started before configuration admin is started then it will start only to
be immediately brought down when it receives its configuration. Using the <a href="https://osgi.org/specification/osgi.cmpn/7.0.0/service.configurator.html">OSGi Configurator</a>, the component
can be brought down a second time. This <em>jojo</em> effect is highly undesirable at startup. (Although the good part is
that it exposes a lot of bugs.)</li>
  <li>Logging – A number of bundles, where the most prevalent is the logger, are more useful when they are running
right from the beginning.</li>
</ul>

<h2 id="startlevel-support-in-bnd">Startlevel Support in bnd</h2>

<p>Run configurations in bnd are described in <em>bndrun</em> files. The list of bundles to run are listed in the  <a href="/instructions/runbundles.html">-runbundles</a>
instruction. The <code class="highlighter-rouge">runbundles</code> instruction has a <code class="highlighter-rouge">startlevel</code> attribute that specifies the startlevel of each bundle.</p>

<p>Since the <code class="highlighter-rouge">-runbundles</code> instruction is frequently calculated by the resolver support in bnd it is not possible to manually
assign the <code class="highlighter-rouge">startlevel</code> attributes to specific bundles. For this reason there is a <em>decorator</em> support in bnd for some selected 
instructions. A decorator is a header with the same name but ending with a plus sign (<code class="highlighter-rouge">+</code>). This instruction acts like a selector
and can be used to assign <code class="highlighter-rouge">startlevel</code> attributes on the <code class="highlighter-rouge">-runbundles</code>.</p>

<h3 id="launching">Launching</h3>

<p>The <a href="/chapters/launching.html">launcher</a> is responsible for installing the bundles after starting or communicating with a framework. The
default bnd launcher will assign each bundle a startlevel, where bundles that do not have a specified <code class="highlighter-rouge">startlevel</code> are
assigned one level higher than the maximum specified levels.</p>

<p>The default launcher will then move the framework startlevel to 2 higher than the highest specified start level.</p>

<h3 id="resolving">Resolving</h3>

<p>The resolve support in bnd can automatically assign <code class="highlighter-rouge">startlevel</code> attributes to the <code class="highlighter-rouge">-runbundles</code> based on different ordering
strategies. There are two strategies that use the dependency graph. This graph can be sorted in <em>topological</em> order.
This means that a resource is always listed ahead of any of its dependencies when there are no cycles.</p>

<p>The <a href="/instructions/runstartlevel.html">-runstartlevel</a> instruction controls the ordering and assigned start levels.</p>

<h2 id="strategies">Strategies</h2>

<p>At the time of this writing it is not yet clear what the best strategy is, and it may depend.</p>

<p>Ordering by the topological sort (a resource is followed by its dependencies) will start something like the log service
last and any applications bundles first. Although at first sight this feels wrong (the log service should be started first
to capture the events at startup) it does solve the jojo problem because one of the last bundles started will be the
Service Component Runtime that will activate all components. At that time all initialization should have taken place.</p>

<p>Reversing the topplogical sort will start the something like SCR and log first because they have few or no dependencies.
Application bundles are then started latest.</p>

<h2 id="numbering">Numbering</h2>

<p>Traditionally start levels are managed by an application bundle. Shell commands can increase and decrease start levels.
For this reason, start levels often use <em>nice</em> numbers.</p>

<p>Using the resolver the need for <em>nice</em> numbers is diminished since bnd is now taking care. The basic default model
is to assign bundles sequentially in selected order from an initial level stepping with 10. The <a href="/instructions/runstartlevel.html">-runstartlevel</a> instruction
can provide the initial level and the step if desired.</p>

<p>The launcher will by default move the framework then to a start level that includes any used start levels. This
default behavior can be blocked by specifyig the <code class="highlighter-rouge">org.osgi.framework.startlevel.beginning</code> property. If this
property is set bnd will assume that there is an agent that will handle the runtime start levels.</p>


			</div>
	</ul>

	
<nav class=next-prev>
	<a href='/releases/5.1.0/chapters/300-launching.html'></a> <a href='/releases/5.1.0/chapters/310-testing.html'></a>
</nav>
<footer class="container12" style="border-top: 1px solid black;padding:10px 0">
	<ul span=12 row>
		<li span=12>
			<ul>
				<li><a href="/releases/5.1.0/">GitHub</a>
			</ul>
	</ul>
</footer>

</body>
</html>
