<!DOCTYPE html>
<html lang="en" ng-app="jpm">

	<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="/releases/5.1.0/css/style.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="/js/releases.js"></script>
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Tips for Windows users</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Tips for Windows users" />
<meta name="author" content="Fr Jeremy Krieg" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Bnd and Bndtools runs on any system that can run Eclipse. However, every operating system is different and has its own quirks. Windows in particular has a few that impact developers using Bnd. While the Bnd experience may never be as smooth on Windows as it is on macOS or Linux, there are a few tweaks that make it a lot smoother than what comes out of the box." />
<meta property="og:description" content="Bnd and Bndtools runs on any system that can run Eclipse. However, every operating system is different and has its own quirks. Windows in particular has a few that impact developers using Bnd. While the Bnd experience may never be as smooth on Windows as it is on macOS or Linux, there are a few tweaks that make it a lot smoother than what comes out of the box." />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Fr Jeremy Krieg"},"url":"/releases/5.1.0/chapters/650-windows.html","headline":"Tips for Windows users","description":"Bnd and Bndtools runs on any system that can run Eclipse. However, every operating system is different and has its own quirks. Windows in particular has a few that impact developers using Bnd. While the Bnd experience may never be as smooth on Windows as it is on macOS or Linux, there are a few tweaks that make it a lot smoother than what comes out of the box.","@type":"WebPage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	
		<style>
			 body {
				counter-reset: h1 29;
			}
		</style>
	

	

	

	

	

	

	

	

	

	

	

	

	

</head>


<body>

	
<ul class="container12 menu-bar">
	<li span=11><a class=menu-link href="/releases/5.1.0/"><img
			class=menu-logo src="/releases/5.1.0/img/bnd-80x40-white.png"></a>
			<a href="/releases/5.1.0/chapters/110-introduction.html">Intro
			</a><a href="/releases/5.1.0/chapters/800-headers.html">Headers
			</a><a href="/releases/5.1.0/chapters/825-instructions-ref.html">Instructions
			</a><a href="/releases/5.1.0/chapters/855-macros-ref.html">Macros
			</a><a href="/releases/5.1.0/chapters/400-commands.html">Commands
			</a><div class="releases"><button class="dropbtn">5.1.0</button><div class="dropdown-content"></div></div>
	<li class=menu-link span=1>
			<a href="https://github.com/bndtools/bnd" target="_"><img
	style="position:absolute;top:0;right:0;margin:0;padding:0;z-index:100"
	src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67"
	alt="Fork me on GitHub"
	data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
</ul>


					

	<ul class=container12>
		<li span=3>
			<div>
			<ul class="side-nav">
	
		
			<li><a href="/releases/5.1.0/chapters/110-introduction.html">Introduction</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/120-install.html">How to install bnd</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/123-tour-workspace.html">Guided Tour</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/125-tour-features.html">Guided Tour Workspace & Projects</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/130-concepts.html">Concepts</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/140-best-practices.html">Best practices</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/150-build.html">Build</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/155-project-setup.html">Project Setup</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/160-jars.html">Generating JARs</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/170-versioning.html">Versioning</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/180-baselining.html">Baselining</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/200-components.html">Service Components</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/210-metatype.html">Metatype</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/220-contracts.html">Contracts</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/230-manifest-annotations.html">Bundle Annotations</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/235-accessor-properties.html">Accessor Properties</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/240-spi-annotations.html">SPI Annotations</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/250-resolving.html">Resolving Dependencies</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/300-launching.html">Launching</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/305-startlevels.html">Startlevels</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/310-testing.html">Testing</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/315-launchpad-testing.html">Testing with Launchpad</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/320-packaging.html">Packaging Applications</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/330-jpms.html">JPMS Libraries</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/390-wrapping.html">Wrapping Libraries to OSGi Bundles</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/395-generating-documentation.html">Generating Documentation</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/400-commands.html">Commands</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/600-developer.html">For Developers</a>
	  	
  	
		
			<li class=selected>Tips for Windows users
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/700-tools.html">Tools bound to bnd</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/800-headers.html">Headers</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/820-instructions.html">Instruction Reference</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/825-instructions-ref.html">Instruction Index</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/850-macros.html">Macro Reference</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/855-macros-ref.html">Macro Index</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/870-plugins.html">Plugins</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/875-external-plugins.html">External Plugins</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/880-settings.html">Settings</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/900-errors.html">Errors</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/910-warnings.html">Warnings</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/920-faq.html">Frequently Asked Questions</a>
	  	
  	
</ul>

			</div>
			
		<li span=9>
			<div class=notes-margin>
				<h1> Tips for Windows users</h1>
				<p>Bnd and Bndtools runs on any system that can run Eclipse. However, every operating system is different and has its own quirks. Windows in particular has a few that impact developers using Bnd. While the Bnd experience may never be as smooth on Windows as it is on macOS or Linux, there are a few tweaks that make it a lot smoother than what comes out of the box.</p>

<p>It is possible that some of the tips listed here will also help for Eclipse development work in general, or perhaps any development work on Windows.</p>

<h2 id="key-problems-on-windows">Key problems on Windows</h2>

<p>Windows has two key architectural differences to *nix-based OSes that really impact development work in Java:</p>

<h3 id="file-locking">File locking</h3>

<p>Most *nix systems use advisory file locking, rather than mandatory locking. Windows uses mandatory locking rather than advisory. Most Java programs are developed on *nix and tend to assume *nix locking semantics. This means that they are not as careful at cleaning up after themselves and ensuring that file locks are released.</p>

<p>In particular, there are problems when an application exits using <code class="highlighter-rouge">System.exit()</code> - the normal way for Java applications to clean up is to release a lock is in a <code class="highlighter-rouge">finally</code> clause. However, when an application calls <code class="highlighter-rouge">System.exit()</code>, these normal channels are bypassed, which means the JVM never gets a chance to release the locks and hence can’t delete the locked files.</p>

<h3 id="real-time-protection">Real-time protection</h3>

<p>From version 10, Windows’ built-in anti-malware program Windows Defender has become very tightly integrated with the OS - seemingly, it is written into the Windows kernel API IO functions themselves, which means it’s nearly impossible to bypass. This makes it extremely well suited to catching malware in the act. Unfortunately, it means it slows down every file write. When you are writing lots of small files, this delay is significant.</p>

<h2 id="workarounds-and-solutions">Workarounds and solutions</h2>

<h3 id="use-bnd-5">Use Bnd 5+</h3>

<p>Prior to Bnd 5.0, there was a bug that caused the launcher to pause for several seconds if you had <a href="/instructions/runtrace.html"><code class="highlighter-rouge">-runtrace</code></a> enabled. This bug has been fixed as of 5.0 (currently in pre-release at the time of writing), so it is worthwhile upgrading to use 5.0 if you are able.</p>

<h3 id="manually-clean-up-temp-files">Manually clean up temp files</h3>

<p>Due to file locking issues, Bnd on Windows will always copy bundles into a newly launched application rather than referencing them (see <a href="/instructions/runnoreferences.html"><code class="highlighter-rouge">-runnoreferences</code></a>). This copy can run to a few hundred megabytes.</p>

<p>Again due to file locking (and its overuse of <code class="highlighter-rouge">System.exit()</code>), Bnd is not very good at cleaning up temporary files on Windows after it exits. So usually, the application folders are left behind after the launched application exits.</p>

<p>A few hundred megabytes per launch starts to add up, and if you’re running off a relatively small SSD you can find yourself running out of disk space.</p>

<p>It is recommended that you periodically clear out these files from your temp directory. By default, the temp directory is in <code class="highlighter-rouge">%UserHome%\AppData\Local\Temp</code>. OSGi temp dirs created by Felix typically have the pattern: <code class="highlighter-rouge">osgi.nnnnnnnnnnnnnnnnn.fw</code>. Depending on which OSGi framework and which Java utilities you are using in your app, there may be others to look out for - if you are using a custom temp dir (see below), then you can simply clear out the entire directory.</p>

<h3 id="turn-offfilter-real-time-malware-protection">Turn off/filter real-time malware protection</h3>

<p>You can turn off real-time malware protection in Windows settings. However, Windows 10 will only allow this situation to persist for a short time (perhaps 24 hours) before automatically turning it back on again. Also, this approach leaves your entire system without any real-time protection.</p>

<p>A better solution is to disable antivirus scanning for specific directories. You can find instructions on how to do this <a href="https://www.windowscentral.com/how-exclude-files-and-folders-windows-defender-antivirus-scans">here</a>. For maximum benefit, you should exclude:</p>
<ul>
  <li>your Bnd workspace;</li>
  <li>the corresponding Eclipse workspace; and</li>
  <li>your temp directory (by default: <code class="highlighter-rouge">%UserHome%\AppData\Local\Temp</code>).
However, excluding your temp directory might be a bit of a security hole as it is likely to be a place where malware will try and write first. If you are concerned about this, see the next section 
for a workaround.</li>
</ul>

<p>It is possible that excluding other directories may help performance, as Windows Defender 
seems to take a keen interest in jar files. Some examples:</p>
<ul>
  <li>your <code class="highlighter-rouge">.m2</code> directory (usually found in your home directory);</li>
  <li>the P2 repository for your local Eclipse installation. This is either in your Eclipse 
root directory, or else in <code class="highlighter-rouge">%UserHome%\.p2</code> directory if you have installed it using 
the P2 bundle pool.</li>
  <li>any other local repositories you might be using in your workspace (that are not already 
covered by one of the above exclusions).</li>
</ul>

<p>Be wary that each additional exclusion you add increases the security risk. You need to weigh the performance benefits of excluding each folder vs the increase in security risk.</p>

<h3 id="create-a-custom-temp-directory">Create a custom temp directory</h3>

<p>As noted above, for best performance you should exclude the temp directory, however for best safety you may not wish to. A good compromise is:</p>

<ul>
  <li>Create a temp directory somewhere else on your machine that is specifically for your development work (eg, <code class="highlighter-rouge">C:\temp</code>).</li>
  <li>Exclude this directory from antivirus scanning.</li>
  <li>Configure Eclipse to use use this directory by adding the <code class="highlighter-rouge">-Djava.io.tmpdir=&lt;path to tmp&gt;</code> vm arg to the <code class="highlighter-rouge">eclipse.ini</code> file.</li>
  <li>Configure your launches’ <code class="highlighter-rouge">.bndrun</code> files to use this temp directory by using the <a href="/instructions/runvm.html"><code class="highlighter-rouge">-runvm</code></a> instruction (eg: <code class="highlighter-rouge">-runvm: -Djava.io.tmpdir=C:\\temp</code> - noting the double-backslash).</li>
</ul>

<p>As an added bonus, this makes cleaning up the remaining temp files much easier as you can safely delete the entire directory, knowing that no other applications are using the directory.</p>

<h4 id="use-a-ram-disk">Use a RAM disk</h4>

<p>If you’ve got an SSD, the above tips should suffice to get good performance. On one test, launching the Bndtools test Eclipse instance itself (with over 200 bundles) took ~2s to install all the bundles for a running Eclipse instance.</p>

<p>However, if you’re using a slower hard disk and you have enough RAM (at least 8GB), you may also consider configuring a small RAM disk of around 1GB and putting your temp directory on the RAM disk. There are a few free RAM disk utilities available for Windows.</p>

<p>You can also easily clear out the accumulated temp files by unmounting and re-mounting the RAM disk.</p>

			</div>
	</ul>

	
<nav class=next-prev>
	<a href='/releases/5.1.0/chapters/600-developer.html'></a> <a href='/releases/5.1.0/chapters/700-tools.html'></a>
</nav>
<footer class="container12" style="border-top: 1px solid black;padding:10px 0">
	<ul span=12 row>
		<li span=12>
			<ul>
				<li><a href="/releases/5.1.0/">GitHub</a>
			</ul>
	</ul>
</footer>

</body>
</html>
