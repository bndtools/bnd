<!DOCTYPE html>
<html lang="en" ng-app="jpm">

	<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="/releases/5.1.0/css/style.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="/js/releases.js"></script>
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Service Components</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Service Components" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The Service-Component header is compatible with the standard OSGi header syntax. Any element in the list that does not have attributes must have a resource in the JAR and is copied as is to the manifest. However, simple components can also be defined inline, and it is even possible to pickup annotations." />
<meta property="og:description" content="The Service-Component header is compatible with the standard OSGi header syntax. Any element in the list that does not have attributes must have a resource in the JAR and is copied as is to the manifest. However, simple components can also be defined inline, and it is even possible to pickup annotations." />
<script type="application/ld+json">
{"url":"/releases/5.1.0/chapters/200-components.html","headline":"Service Components","description":"The Service-Component header is compatible with the standard OSGi header syntax. Any element in the list that does not have attributes must have a resource in the JAR and is copied as is to the manifest. However, simple components can also be defined inline, and it is even possible to pickup annotations.","@type":"WebPage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


	

	

	

	

	

	

	

	

	

	

	

	
		<style>
			 body {
				counter-reset: h1 12;
			}
		</style>
	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

</head>


<body>

	
<ul class="container12 menu-bar">
	<li span=11><a class=menu-link href="/releases/5.1.0/"><img
			class=menu-logo src="/releases/5.1.0/img/bnd-80x40-white.png"></a>
			<a href="/releases/5.1.0/chapters/110-introduction.html">Intro
			</a><a href="/releases/5.1.0/chapters/800-headers.html">Headers
			</a><a href="/releases/5.1.0/chapters/825-instructions-ref.html">Instructions
			</a><a href="/releases/5.1.0/chapters/855-macros-ref.html">Macros
			</a><a href="/releases/5.1.0/chapters/400-commands.html">Commands
			</a><div class="releases"><button class="dropbtn">5.1.0</button><div class="dropdown-content"></div></div>
	<li class=menu-link span=1>
			<a href="https://github.com/bndtools/bnd" target="_"><img
	style="position:absolute;top:0;right:0;margin:0;padding:0;z-index:100"
	src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67"
	alt="Fork me on GitHub"
	data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
</ul>


					

	<ul class=container12>
		<li span=3>
			<div>
			<ul class="side-nav">
	
		
			<li><a href="/releases/5.1.0/chapters/110-introduction.html">Introduction</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/120-install.html">How to install bnd</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/123-tour-workspace.html">Guided Tour</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/125-tour-features.html">Guided Tour Workspace & Projects</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/130-concepts.html">Concepts</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/140-best-practices.html">Best practices</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/150-build.html">Build</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/155-project-setup.html">Project Setup</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/160-jars.html">Generating JARs</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/170-versioning.html">Versioning</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/180-baselining.html">Baselining</a>
	  	
  	
		
			<li class=selected>Service Components
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/210-metatype.html">Metatype</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/220-contracts.html">Contracts</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/230-manifest-annotations.html">Bundle Annotations</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/235-accessor-properties.html">Accessor Properties</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/240-spi-annotations.html">SPI Annotations</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/250-resolving.html">Resolving Dependencies</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/300-launching.html">Launching</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/305-startlevels.html">Startlevels</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/310-testing.html">Testing</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/315-launchpad-testing.html">Testing with Launchpad</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/320-packaging.html">Packaging Applications</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/330-jpms.html">JPMS Libraries</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/390-wrapping.html">Wrapping Libraries to OSGi Bundles</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/395-generating-documentation.html">Generating Documentation</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/400-commands.html">Commands</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/600-developer.html">For Developers</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/650-windows.html">Tips for Windows users</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/700-tools.html">Tools bound to bnd</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/800-headers.html">Headers</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/820-instructions.html">Instruction Reference</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/825-instructions-ref.html">Instruction Index</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/850-macros.html">Macro Reference</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/855-macros-ref.html">Macro Index</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/870-plugins.html">Plugins</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/875-external-plugins.html">External Plugins</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/880-settings.html">Settings</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/900-errors.html">Errors</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/910-warnings.html">Warnings</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/920-faq.html">Frequently Asked Questions</a>
	  	
  	
</ul>

			</div>
			
		<li span=9>
			<div class=notes-margin>
				<h1> Service Components</h1>
				<p>The Service-Component header is compatible with the standard OSGi header syntax. Any element in the list that does not have attributes must have a resource in the JAR and is copied as is to the manifest. However, simple components can also be defined inline, and it is even possible to pickup annotations.</p>

<p>The syntax for these component definitions is:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>component ::= &lt;name&gt; ( ';' parameter ) *
parameter ::= provide | reference | multiple | optional
            | reference | properties | factory | servicefactory
            | immediate | enabled | implementation
            | activate | deactivate | modified | configuration-policy
            | version | designate

reference ::= &lt;name&gt; '=' &lt;interface-class&gt;
               ( '(' &lt;target-filter&gt; ')')? cardinality?
cardinality ::= '?' | '*' | '+' | '~'
provide  ::= 'provide:=' LIST
multiple  ::= 'multiple:=' LIST
optional  ::= 'optional:=' LIST
dynamic   ::= 'dynamic:=' LIST
designate  ::= ( 'designate' | 'designateFactory' ) CLASS
factory   ::= 'factory:=' true | false
servicefactory := 'servicefactory:=' true | false
immediate ::= 'immediate:=' true | false
enabled   ::= 'enabled:=' true | false
configuration-policy ::= "configuration-policy:='
     ( 'optional' | 'require' | 'ignore' )
activate  ::= 'activate:=' METHOD
modified  ::= 'modified:=' METHOD
deactivate::= 'deactivate:=' METHOD
implementation::= 'implementation:=' &lt;implementation-class&gt;
properties::= 'properties:=' key '=' value
              ( ',' key '=' value ) *
key       ::= NAME (( '@' | ':' ) type )?
value     ::= value ( '|' value )*
</code></pre></div></div>

<p>If the name of the component maps to a resource, or ends in XML, or there are attributes set, then that clause is copied to the output Service-Component header.</p>

<p>If the name can be expanded to one or more classes that have component annotations (they must be inside the JAR), then each of those classes is analyzed for its component annotations. These annotations are then merged with the attributes from the header, where the header attributes override annotations. The expansion uses the normal wildcard rules. For example, <code class="highlighter-rouge">biz.aQute.components.*</code> will search for component annotated classes in the  <code class="highlighter-rouge">biz.aQute.components</code> package or one of its descendants. The classes must be present in the JAR. If no classes with annotations can be found for the <code class="highlighter-rouge">name</code> then it is assumed to be name or implementation class name without annotations.</p>

<p>The name of the component is also the implementation class (unless overridden by the implementation: directive). It is then followed with a number of references and directives. A reference defines a name that can be used with the <code class="highlighter-rouge">locateService</code> method from the <code class="highlighter-rouge">ComponentContext</code> class. If the name starts with a lower case character, it is assume to be a bean property. In that case the reference is augmented with a <code class="highlighter-rouge">set&lt;Name&gt;</code> and <code class="highlighter-rouge">unset&lt;Name&gt;</code> method according to the standard bean rules. Bnd will interpret the header, read the annotations if possible, and create the corresponding resources in the output jar under the name <code class="highlighter-rouge">OSGI-INF/&lt;id&gt;.xml</code>.</p>

<p>Annotations are only recognized on the component class, super classes are not inspected for the components.</p>

<p>The supported annotations in the <code class="highlighter-rouge">aQute.bnd.annotations.component</code> package are:</p>

<p>||!Component||
Annotated the class, indicates this class is required to be a component. It has the following properties:</p>

<table>
  <tbody>
    <tr>
      <td> </td>
      <td>provide</td>
      <td> </td>
      <td>Class[]</td>
      <td> </td>
      <td>Service interfaces, the default is all directly implemented interfaces</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td> </td>
      <td>name</td>
      <td> </td>
      <td>String</td>
      <td> </td>
      <td>Name of the component</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td> </td>
      <td>factory</td>
      <td> </td>
      <td>Boolean</td>
      <td> </td>
      <td>Factory component</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td> </td>
      <td>servicefactory</td>
      <td> </td>
      <td>Boolean</td>
      <td> </td>
      <td>Service Factory</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td> </td>
      <td>immediate</td>
      <td> </td>
      <td>Boolean</td>
      <td> </td>
      <td>Immediate activation</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td> </td>
      <td>designate</td>
      <td> </td>
      <td>CLASS</td>
      <td> </td>
      <td>Designate a class as a [[MetaType]] interface used for configurations for unitary configurations, see [[#metatype]]. This changes the default of the configurationPolicy to <code class="highlighter-rouge">require</code>.</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td> </td>
      <td>designateFactory</td>
      <td> </td>
      <td>CLASS</td>
      <td> </td>
      <td>Designate a class as a [[MetaType]] interface used for configurations for factory configurations, see [[#metatype]]. This changes the default of the configurationPolicy to <code class="highlighter-rouge">require</code>.</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td> </td>
      <td>configurationPolicy</td>
      <td> </td>
      <td>OPTIONAL, REQUIRE, IGNORE</td>
      <td> </td>
      <td>Configuration Policy</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td> </td>
      <td>enabled</td>
      <td> </td>
      <td>Boolean</td>
      <td> </td>
      <td>Enabled component</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td> </td>
      <td>properties</td>
      <td> </td>
      <td>String[]</td>
      <td> </td>
      <td>Properties specified as an array of <code class="highlighter-rouge">key=value</code>. The property type can be specified in the key as <code class="highlighter-rouge">name:Integer</code>. The value can contain multiple values, the parts must then be separated by a vertical bar (‘</td>
      <td>’) or a line feed (\n), for example <code class="highlighter-rouge">properties = {"primes:Integer==1|2|3|5|7|11"</code>}.</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p>||!Reference||
On a method. Indicates this method is the activate method. It has the following attributes</p>

<table>
  <tbody>
    <tr>
      <td> </td>
      <td>name</td>
      <td> </td>
      <td>String</td>
      <td> </td>
      <td>Name of the reference. Default this is the name of the method without set on it.</td>
      <td> </td>
    </tr>
    <tr>
      <td> </td>
      <td>service</td>
      <td> </td>
      <td>Class</td>
      <td> </td>
      <td>The service type, default is the argument type of the method. The unset method is derived from this name. I.e. setXX will have an unsetXX method to unset the reference.</td>
      <td> </td>
    </tr>
    <tr>
      <td> </td>
      <td>type</td>
      <td> </td>
      <td>Character</td>
      <td> </td>
      <td>Standard cardinality type ‘?’, ‘*’, ‘+’,’~’</td>
      <td> </td>
    </tr>
    <tr>
      <td> </td>
      <td>target</td>
      <td> </td>
      <td>String</td>
      <td> </td>
      <td>A filter expression applied to the properties of the target service</td>
      <td> </td>
    </tr>
    <tr>
      <td> </td>
      <td>unbind</td>
      <td> </td>
      <td>String</td>
      <td> </td>
      <td>Optional name of the unbind method. By default this is the same name as the bind method name but with set/add replaced with unset/remove. E.g. setFoo() bind method becomes unsetFoo() unbind method.</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p><code class="highlighter-rouge">@Reference</code> automatically sets the bind method. The unbind method is set by using a derived name from the bind method or providing it with the name of the unbind method. The following name patterns are supported:</p>

<p>||!bind||!unbind||
||<code class="highlighter-rouge">setX</code> ||<code class="highlighter-rouge">unsetX</code>||
||<code class="highlighter-rouge">addX</code> ||<code class="highlighter-rouge">removeX</code>||
||<code class="highlighter-rouge">xxxX</code> ||<code class="highlighter-rouge">unxxxX</code>||
For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Reference
protected void setFoo(LogService l) { ... }
protected void unsetFoo(LogService l) { ... }
</code></pre></div></div>

<p>If you want to override this, use</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Reference(unbind="IRefuseToCallMyMethodUnFoo");
protected void foo(LogService l) {}
protected void IRefuseToCallMyMethodUnFoo(LogService l) {}
</code></pre></div></div>

<p>Unfortunately Java has no method references so it is not type safe.A non existent <code class="highlighter-rouge">@UnReference</code> annotation is not very useful because that still requires linking it up symbolically to the associated <code class="highlighter-rouge">@Reference</code>.</p>

<p>||!Activate, Modified, and Deactivate||
The life cycle methods. These annotations have no properties.</p>

<p>Assume the JAR contains the following class:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">com</span><span class="p">.</span><span class="n">acme</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">osgi</span><span class="p">.</span><span class="n">service</span><span class="p">.</span><span class="n">event</span><span class="p">.*;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">osgi</span><span class="p">.</span><span class="n">service</span><span class="p">.</span><span class="nb">log</span><span class="p">.*;</span>
<span class="n">import</span> <span class="n">aQute</span><span class="p">.</span><span class="n">bnd</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">component</span><span class="p">.*;</span>

<span class="p">@</span><span class="n">Component</span>
<span class="k">public</span> <span class="n">class</span> <span class="n">AnnotatedComponent</span> <span class="n">implements</span> <span class="n">EventHandler</span> <span class="p">{</span>
  <span class="n">LogService</span> <span class="nb">log</span><span class="p">;</span>

  <span class="p">@</span><span class="n">Reference</span>
  <span class="n">void</span> <span class="n">setLog</span><span class="p">(</span><span class="n">LogService</span> <span class="nb">log</span><span class="p">)</span> <span class="p">{</span> <span class="n">this</span><span class="p">.</span><span class="nb">log</span><span class="p">=</span><span class="nb">log</span><span class="p">;</span> <span class="p">}</span>

  <span class="k">public</span> <span class="n">void</span> <span class="n">handleEvent</span><span class="p">(</span><span class="n">Event</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">log</span><span class="p">.</span><span class="nb">log</span><span class="p">(</span><span class="n">LogService</span><span class="p">.</span><span class="n">LOG_INFO</span><span class="p">,</span> <span class="n">event</span><span class="p">.</span><span class="n">getTopic</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The only thing necessary to register the Declarative Service component is to add the following Service-Component header:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Service-Component: com.acme.*
</code></pre></div></div>

<p>This header will look for annotations in all com.acme sub-packages for an annotated component. The resulting XML will look like:</p>

<p>OSGI-INF/com.acme.AnnotatedComponent.xml:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">'com.acme.AnnotatedComponent'</span><span class="nt">&gt;</span>
  <span class="nt">&lt;implementation</span> <span class="na">class=</span><span class="s">'com.acme.AnnotatedComponent'</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;service&gt;</span>
    <span class="nt">&lt;provide</span> <span class="na">interface=</span><span class="s">'org.osgi.service.event.EventHandler'</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/service&gt;</span>
  <span class="nt">&lt;reference</span> <span class="na">name=</span><span class="s">'log'</span>
    <span class="na">interface=</span><span class="s">'org.osgi.service.log.LogService'</span>
    <span class="na">bind=</span><span class="s">'setLog'</span>
    <span class="na">unbind=</span><span class="s">'unsetLog'</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</code></pre></div></div>

<p>The following example shows a component that is bound to the log service via the setLog method without annotations:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Service-Component=aQute.tutorial.component.World;
  log=org.osgi.service.log.LogService
</code></pre></div></div>

<p>The Service Component Runtime (SCR) offers a variety of options on the reference. Some options like the target can be used by adding the target filter after the interface name (this likely requires putting quotes around the interface name+filter).</p>

<p>References can be suffixed with the following characters to indicate their cardinality:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Char          Cardinality    Policy
?             0..1           dynamic
*             0..n           dynamic
+             1..n           dynamic
~             0..1           static
              1              static
</code></pre></div></div>

<p>For a more complex example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Service-Component=aQute.tutorial.component.World;
  log=org.osgi.service.log.LogService?;
  http=org.osgi.service.http.HttpService;
  PROCESSORS="xierpa.service.processor.Processor(priority&gt;1)+";
  properties:="wazaabi=true"
</code></pre></div></div>

<p>The previous example will result in the following service component in the resource <code class="highlighter-rouge">OSGI-INF/aQute.tutorial.component.World.xml</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span>
<span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">"aQute.tutorial.component.World"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;implementation</span> <span class="na">class=</span><span class="s">"aQute.tutorial.component.World"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;reference</span> <span class="na">name=</span><span class="s">"log"</span>
    <span class="na">interface=</span><span class="s">"org.osgi.service.log.LogService"</span>
    <span class="na">cardinality=</span><span class="s">"0..1"</span>
    <span class="na">bind=</span><span class="s">"setLog"</span>
    <span class="na">unbind=</span><span class="s">"unsetLog"</span>
    <span class="na">policy=</span><span class="s">"dynamic"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;reference</span> <span class="na">name=</span><span class="s">"http"</span>
    <span class="na">interface=</span><span class="s">"org.osgi.service.http.HttpService"</span>
    <span class="na">bind=</span><span class="s">"setHttp"</span>
    <span class="na">unbind=</span><span class="s">"unsetHttp"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;reference</span> <span class="na">name=</span><span class="s">"PROCESSORS"</span>
    <span class="na">interface=</span><span class="s">"xierpa.service.processor.Processor"</span>
    <span class="na">cardinality=</span><span class="s">"1..n"</span>
    <span class="na">policy=</span><span class="s">"dynamic"</span>
    <span class="na">target=</span><span class="s">"(&amp;(priority&gt;=1)(link=false))"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</code></pre></div></div>

<p>The description also supports the immediate, enabled, factory, target, servicefactory, configuration-policy, activate, deactivate, and modified attributes. Refer to the Declarative Services definition for their semantics.</p>

<p>If any feature of the V1.1 namespace is used, then bnd will declare the namespace in the <code class="highlighter-rouge">component</code> element. A specific namespace version can be set with the <code class="highlighter-rouge">version</code> directive. This detection only works when components are used.</p>

<p>Bnd also supports setting the policy and cardinality through the following directives:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>multiple:= LIST    names of references that have x..n
optional:= LIST    names of references that have 0..x
dynamic:=  LIST    names of references that are dynamic
</code></pre></div></div>

<h2 id="components-and-metatype">Components and Metatype</h2>
<p>The Service Component Runtime works closely together with the Configuration Admin to allow the components to be controlled through configuration. Configuration Admin knows two types of configuration:</p>

<ul>
  <li>Unitary</li>
  <li>Factory</li>
</ul>

<p>A unitary configuration can be set and changed but there is at most one of them. A Factory configuration can be used to create multiple instances of the same component. A component has a configuration policy that defines when no configuration is set.</p>

<ul>
  <li>optional - If no configuration is set (either unitary or factory) then the component is still created.</li>
  <li>require - This requires a unitary configuration to be set or one or more factory configurations before a component is created.</li>
  <li>ignore - Ignore configuration information</li>
</ul>

<p>A related standard is the Metatype standard. The Metatype Service provides a repository of property descriptors. Bundles can provide these descriptors in their bundles in the OSGI-INF/metatype directory. There are tools, like the [Felix Webconsole][http://felix.apache.org/site/apache-felix-web-console.html], that can provide an editing window for a configuration that is typed with a metatype description.</p>

<p>In practice, this is a powerful model that provides a lot of configurability for your components with easy editing but getting it all right is not trivial. To make this easier, bnd has made it ease to use configurations.</p>

<p>In this model, configurations are declared in an interface. For example, the following interface defines a simple message:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>interface Config {
  String message(); // message to give
}
</code></pre></div></div>

<p>To create a component that can work with this config, we need to designate that interface as the configuration interface for a component.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Component(designate=Config.class)
public class BasicComponent {
    Config config;

    @Activate void activate(Map&lt;String,Object&gt; props) {
       config = Configurable.createConfig(props);
       System.out.println("Hi " + config.message());
    }

    @Deactivate void deactivate() {
       System.out.println("Bye " + config.message());
    }
}
</code></pre></div></div>

<p>This is an immediate component because it does not implement a service interface. It also requires a configuration because we have not specified this explicitly. When you use designate (or designateFactory) the default becomes require. This means that your component will only be created when there is actually configuration for it set.</p>

<p>To run this component, make sure you have the Felix Webconsole running and the MetaType service installed. In the Webconsole, you can click on
‘'’Configuration’’’, your component should be listed on this page. By Clicking on the component with the name ‘'’Basic Component Config’’’ you get an editor window.</p>

<p>The editor is aware of the proper types, it uses the [[MetaType]] standard to describe the properties. bnd uses the type information on the interface as well as the optional Metadata annotations to create a rich description that allows the web console to provide a good editor.</p>

<p>You can fill in the message in the ‘‘Message’’ field. If you save the editor, your component prints the message with “Hi” in front of it. Deleting the configuration will print the message with “Bye”.</p>

<p>If you change the message, you will see that the component is first deactivated and then reactivated again. This is the only possibility for the SCR because the component has not implemented a modified method. Adding the following method will change this, now changes to the configuration are signaled to the component and the component can continue to work. This is more complicated then recycling the component but it can create a more optimized system.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Modified
void modified( Map&lt;String,Object&gt; props) {
  // reuse activate method
  activate(props);
}
</code></pre></div></div>

<p>It is also possible to take advantage of the configuration factories. In this model</p>

<p>An example, that implements a simple socket server on a configurable port and returns a message when a telnet session is opened to that port can be found on [Github][https://github.com/bnd/aQute/blob/master/aQute.metatype/src/aQute/metatype/components/ServerSocketComponent.java].</p>


			</div>
	</ul>

	
<nav class=next-prev>
	<a href='/releases/5.1.0/chapters/180-baselining.html'></a> <a href='/releases/5.1.0/chapters/210-metatype.html'></a>
</nav>
<footer class="container12" style="border-top: 1px solid black;padding:10px 0">
	<ul span=12 row>
		<li span=12>
			<ul>
				<li><a href="/releases/5.1.0/">GitHub</a>
			</ul>
	</ul>
</footer>

</body>
</html>
