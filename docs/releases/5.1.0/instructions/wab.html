<!DOCTYPE html>
<html lang="en" ng-app="jpm">

	<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="/releases/5.1.0/css/style.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="/js/releases.js"></script>
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>-wab FILE ( ‘,’ FILE )*</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="-wab FILE ( ‘,’ FILE )*" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In OSGi Enterprise 4.2 the concept of Web Archive Bundles were introduced. Web Archive Bundles are 100% normal bundles following all the rules of OSGi. Their speciality is that they can be mapped to a web server following several of the rules of Java Enterprise Edition’s Servlet model. The big difference is that the WARs of the servlet model have a rather strict layout of their archive because the servlet container also handles class loading. In OSGi, the class loading is very well specified and it would therefore be wrong to create special rules." />
<meta property="og:description" content="In OSGi Enterprise 4.2 the concept of Web Archive Bundles were introduced. Web Archive Bundles are 100% normal bundles following all the rules of OSGi. Their speciality is that they can be mapped to a web server following several of the rules of Java Enterprise Edition’s Servlet model. The big difference is that the WARs of the servlet model have a rather strict layout of their archive because the servlet container also handles class loading. In OSGi, the class loading is very well specified and it would therefore be wrong to create special rules." />
<script type="application/ld+json">
{"url":"/releases/5.1.0/instructions/wab.html","headline":"-wab FILE ( ‘,’ FILE )*","description":"In OSGi Enterprise 4.2 the concept of Web Archive Bundles were introduced. Web Archive Bundles are 100% normal bundles following all the rules of OSGi. Their speciality is that they can be mapped to a web server following several of the rules of Java Enterprise Edition’s Servlet model. The big difference is that the WARs of the servlet model have a rather strict layout of their archive because the servlet container also handles class loading. In OSGi, the class loading is very well specified and it would therefore be wrong to create special rules.","@type":"WebPage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

</head>


<body>

	
<ul class="container12 menu-bar">
	<li span=11><a class=menu-link href="/releases/5.1.0/"><img
			class=menu-logo src="/releases/5.1.0/img/bnd-80x40-white.png"></a>
			<a href="/releases/5.1.0/chapters/110-introduction.html">Intro
			</a><a href="/releases/5.1.0/chapters/800-headers.html">Headers
			</a><a href="/releases/5.1.0/chapters/825-instructions-ref.html">Instructions
			</a><a href="/releases/5.1.0/chapters/855-macros-ref.html">Macros
			</a><a href="/releases/5.1.0/chapters/400-commands.html">Commands
			</a><div class="releases"><button class="dropbtn">5.1.0</button><div class="dropdown-content"></div></div>
	<li class=menu-link span=1>
			<a href="https://github.com/bndtools/bnd" target="_"><img
	style="position:absolute;top:0;right:0;margin:0;padding:0;z-index:100"
	src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67"
	alt="Fork me on GitHub"
	data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
</ul>


					

	<ul class=container12>
		<li span=3>
			<div>
			<ul class="side-nav">
	
		
			<li><a href="/releases/5.1.0/chapters/110-introduction.html">Introduction</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/120-install.html">How to install bnd</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/123-tour-workspace.html">Guided Tour</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/125-tour-features.html">Guided Tour Workspace & Projects</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/130-concepts.html">Concepts</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/140-best-practices.html">Best practices</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/150-build.html">Build</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/155-project-setup.html">Project Setup</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/160-jars.html">Generating JARs</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/170-versioning.html">Versioning</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/180-baselining.html">Baselining</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/200-components.html">Service Components</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/210-metatype.html">Metatype</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/220-contracts.html">Contracts</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/230-manifest-annotations.html">Bundle Annotations</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/235-accessor-properties.html">Accessor Properties</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/240-spi-annotations.html">SPI Annotations</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/250-resolving.html">Resolving Dependencies</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/300-launching.html">Launching</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/305-startlevels.html">Startlevels</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/310-testing.html">Testing</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/315-launchpad-testing.html">Testing with Launchpad</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/320-packaging.html">Packaging Applications</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/330-jpms.html">JPMS Libraries</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/390-wrapping.html">Wrapping Libraries to OSGi Bundles</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/395-generating-documentation.html">Generating Documentation</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/400-commands.html">Commands</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/600-developer.html">For Developers</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/650-windows.html">Tips for Windows users</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/700-tools.html">Tools bound to bnd</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/800-headers.html">Headers</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/820-instructions.html">Instruction Reference</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/825-instructions-ref.html">Instruction Index</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/850-macros.html">Macro Reference</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/855-macros-ref.html">Macro Index</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/870-plugins.html">Plugins</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/875-external-plugins.html">External Plugins</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/880-settings.html">Settings</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/900-errors.html">Errors</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/910-warnings.html">Warnings</a>
	  	
  	
		
			<li><a href="/releases/5.1.0/chapters/920-faq.html">Frequently Asked Questions</a>
	  	
  	
</ul>

			</div>
			
		<li span=9>
			<div class=notes-margin>
				<h1> -wab FILE ( ',' FILE )*</h1>
				<p>In OSGi Enterprise 4.2 the concept of Web Archive Bundles were introduced. Web Archive Bundles are 100% normal bundles following all the rules of OSGi. Their speciality is that they can be mapped to a web server following several of the rules of Java Enterprise Edition’s Servlet model. The big difference is that the WARs of the servlet model have a rather strict layout of their archive because the servlet container also handles class loading. In OSGi, the class loading is very well specified and it would therefore be wrong to create special rules.</p>

<p>However, the OSGi supports the Bundle-Classpath header. This header allows the organization of the internal layout. It turns out that it is possible to create a valid Web Application Bundle (WAB) that is also a valid Web ARchive (WAR). Being deploy an archive both to OSGi and an application server obviously has advantages. bnd therefore supports a number of instructions that make it easy to create these dual mode archives.</p>

<p>The <code class="highlighter-rouge">-wab</code> instruction instructs bnd to move the root of the created archive to WEB-INF/classes. That is, you build your bundle in the normal way,not using the <code class="highlighter-rouge">Bundle-ClassPath</code>. The <code class="highlighter-rouge">-wab</code> command then moves the root of the archive so the complete class path for the bundle is no inside the WEB-INF/classes directory. It then adjusts the <code class="highlighter-rouge">Bundle-ClassPath</code> header to reflect this new location of the classes and resources.</p>

<p>The new root now only contains WEB-INF. In the Servlet specification, the root of the archive is mapped to the server’s context URL. It is therefore often necessary to place static files in the root. For this reason, the <code class="highlighter-rouge">-wab</code> instruction has the same form as <a href="includeresource.html">Include-Resource</a> header, and performs the same function. However, it performs this function of copying resources from the file system after the classes and resources of the original bundle have been moved to WEB-INF.</p>

<p>For example, the following code creates a simple WAB/WAR:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Private-Package:   com.example.impl.*
  Export-Package:    com.example.service.myapi
  Include-Resource:  resources/
  -wab:              static-pages/
</code></pre></div></div>

<p>The layout of the resulting archive is:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  WEB-INF/classes/com/example/impl/
  WEB-INF/classes/com/example/service/myapi/
  WEB-INF/classes/resources/
  index.html // from static-pages
</code></pre></div></div>

<p>The <code class="highlighter-rouge">Bundle-ClassPath</code> is <code class="highlighter-rouge">WEB-INF/classes</code>.</p>

<p>WARs can carry a <code class="highlighter-rouge">WEB-INF/lib</code> directory. Any archive in this directory is mapped to the class path of the WAR. The OSGi specifications do not recognize directories with archives it is therefore necessary to list these archives also on the <code class="highlighter-rouge">Bundle-ClassPath</code> header. This is cumbersome to do by hand so the <code class="highlighter-rouge">-wablib</code> command will take a list of paths.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Private-Package:   com.example.impl.*
  Export-Package:    com.example.service.myapi
  Include-Resource:  resources/
  -wab:              static-pages/
  -wablib:			 lib/a.jar, lib/b.jar
</code></pre></div></div>

<p>This results in a layout of:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  WEB-INF/classes/com/example/impl/
  WEB-INF/classes/com/example/service/myapi/
  WEB-INF/classes/resources/
  WEB-INF/lib/
    a.jar
    b.jar
  index.html ( from static-pages)
</code></pre></div></div>

<p>The <code class="highlighter-rouge">Bundle-ClassPath</code> is now set to <code class="highlighter-rouge">WEB-INF/classes,WEB-INF/lib/a.jar,WEB-INF/lib/a.jar</code></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="cm">/**
	 * Turn this normal bundle in a web and add any resources.
	 *
	 * @throws Exception
	 */</span>
	<span class="kd">private</span> <span class="nc">Jar</span> <span class="nf">doWab</span><span class="o">(</span><span class="nc">Jar</span> <span class="n">dot</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">wab</span> <span class="o">=</span> <span class="n">getProperty</span><span class="o">(</span><span class="no">WAB</span><span class="o">);</span>
		<span class="nc">String</span> <span class="n">wablib</span> <span class="o">=</span> <span class="n">getProperty</span><span class="o">(</span><span class="no">WABLIB</span><span class="o">);</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">wab</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">wablib</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
			<span class="k">return</span> <span class="n">dot</span><span class="o">;</span>

		<span class="n">trace</span><span class="o">(</span><span class="s">"wab %s %s"</span><span class="o">,</span> <span class="n">wab</span><span class="o">,</span> <span class="n">wablib</span><span class="o">);</span>
		<span class="n">setBundleClasspath</span><span class="o">(</span><span class="n">append</span><span class="o">(</span><span class="s">"WEB-INF/classes"</span><span class="o">,</span> <span class="n">getProperty</span><span class="o">(</span><span class="no">BUNDLE_CLASSPATH</span><span class="o">)));</span>

		<span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">paths</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(</span><span class="n">dot</span><span class="o">.</span><span class="na">getResources</span><span class="o">().</span><span class="na">keySet</span><span class="o">());</span>

		<span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">path</span> <span class="o">:</span> <span class="n">paths</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">path</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="sc">'/'</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nc">Character</span><span class="o">.</span><span class="na">isUpperCase</span><span class="o">(</span><span class="n">path</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">0</span><span class="o">)))</span> <span class="o">{</span>
				<span class="n">trace</span><span class="o">(</span><span class="s">"wab: moving: %s"</span><span class="o">,</span> <span class="n">path</span><span class="o">);</span>
				<span class="n">dot</span><span class="o">.</span><span class="na">rename</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="s">"WEB-INF/classes/"</span> <span class="o">+</span> <span class="n">path</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>

		<span class="nc">Parameters</span> <span class="n">clauses</span> <span class="o">=</span> <span class="n">parseHeader</span><span class="o">(</span><span class="n">getProperty</span><span class="o">(</span><span class="no">WABLIB</span><span class="o">));</span>
		<span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">key</span> <span class="o">:</span> <span class="n">clauses</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>
			<span class="nc">File</span> <span class="n">f</span> <span class="o">=</span> <span class="n">getFile</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
			<span class="n">addWabLib</span><span class="o">(</span><span class="n">dot</span><span class="o">,</span> <span class="n">f</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="n">doIncludeResource</span><span class="o">(</span><span class="n">dot</span><span class="o">,</span> <span class="n">wab</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">dot</span><span class="o">;</span>
	<span class="o">}</span>
</code></pre></div></div>

			</div>
	</ul>

	
<nav class=next-prev>
	<a href='/releases/5.1.0/instructions/upto.html'></a> <a href='/releases/5.1.0/instructions/wablib.html'></a>
</nav>
<footer class="container12" style="border-top: 1px solid black;padding:10px 0">
	<ul span=12 row>
		<li span=12>
			<ul>
				<li><a href="/releases/5.1.0/">GitHub</a>
			</ul>
	</ul>
</footer>

</body>
</html>
