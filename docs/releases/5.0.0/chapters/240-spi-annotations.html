<!DOCTYPE html>
<html lang="en" ng-app="jpm">

	<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="/releases/5.0.0/css/style.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="/js/releases.js"></script>
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>SPI Annotations</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="SPI Annotations" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Writing Java libraries which support OSGi does not typically require more than generating proper OSGi metadata. bnd helps accomplish with minimal effort on the part of developers. One issue that remains somewhat complex is properly handling the use of the Java SPI such that it works seamlessly in OSGi and avoiding the need for custom code to accomplish a similar goal. OSGi defines the Service Loader Mediator Specification but applying it requires a significant amount of manifest metadata." />
<meta property="og:description" content="Writing Java libraries which support OSGi does not typically require more than generating proper OSGi metadata. bnd helps accomplish with minimal effort on the part of developers. One issue that remains somewhat complex is properly handling the use of the Java SPI such that it works seamlessly in OSGi and avoiding the need for custom code to accomplish a similar goal. OSGi defines the Service Loader Mediator Specification but applying it requires a significant amount of manifest metadata." />
<script type="application/ld+json">
{"@type":"WebPage","headline":"SPI Annotations","url":"/releases/5.0.0/chapters/240-spi-annotations.html","description":"Writing Java libraries which support OSGi does not typically require more than generating proper OSGi metadata. bnd helps accomplish with minimal effort on the part of developers. One issue that remains somewhat complex is properly handling the use of the Java SPI such that it works seamlessly in OSGi and avoiding the need for custom code to accomplish a similar goal. OSGi defines the Service Loader Mediator Specification but applying it requires a significant amount of manifest metadata.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	
		<style>
			 body {
				counter-reset: h1 17;
			}
		</style>
	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

</head>


<body>

	
<ul class="container12 menu-bar">
	<li span=11><a class=menu-link href="/releases/5.0.0/"><img
			class=menu-logo src="/releases/5.0.0/img/bnd-80x40-white.png"></a>
			<a href="/releases/5.0.0/chapters/110-introduction.html">Intro
			</a><a href="/releases/5.0.0/chapters/800-headers.html">Headers
			</a><a href="/releases/5.0.0/chapters/825-instructions-ref.html">Instructions
			</a><a href="/releases/5.0.0/chapters/855-macros-ref.html">Macros
			</a><a href="/releases/5.0.0/chapters/400-commands.html">Commands
			</a><div class="releases"><button class="dropbtn">5.0.0</button><div class="dropdown-content"></div></div>
	<li class=menu-link span=1>
			<a href="https://github.com/bndtools/bnd" target="_"><img
	style="position:absolute;top:0;right:0;margin:0;padding:0;z-index:100"
	src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67"
	alt="Fork me on GitHub"
	data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
</ul>


					

	<ul class=container12>
		<li span=3>
			<div>
			<ul class="side-nav">
	
		
			<li><a href="/releases/5.0.0/chapters/110-introduction.html">Introduction</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/120-install.html">How to install bnd</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/123-tour-workspace.html">Guided Tour</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/125-tour-features.html">Guided Tour Workspace & Projects</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/130-concepts.html">Concepts</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/140-best-practices.html">Best practices</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/150-build.html">Build</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/155-project-setup.html">Project Setup</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/160-jars.html">Generating JARs</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/170-versioning.html">Versioning</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/180-baselining.html">Baselining</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/200-components.html">Service Components</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/210-metatype.html">Metatype</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/220-contracts.html">Contracts</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/230-manifest-annotations.html">Bundle Annotations</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/235-accessor-properties.html">Accessor Properties</a>
	  	
  	
		
			<li class=selected>SPI Annotations
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/250-resolving.html">Resolving Dependencies</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/300-launching.html">Launching</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/305-startlevels.html">Startlevels</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/310-testing.html">Testing</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/315-launchpad-testing.html">Testing with Launchpad</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/320-packaging.html">Packaging Applications</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/330-jpms.html">JPMS Libraries</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/390-wrapping.html">Wrapping Libraries to OSGi Bundles</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/395-generating-documentation.html">Generating Documentation</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/400-commands.html">Commands</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/600-developer.html">For Developers</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/650-windows.html">Tips for Windows users</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/700-tools.html">Tools bound to bnd</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/800-headers.html">Headers</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/820-instructions.html">Instruction Reference</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/825-instructions-ref.html">Instruction Index</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/850-macros.html">Macro Reference</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/855-macros-ref.html">Macro Index</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/870-plugins.html">Plugins</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/880-settings.html">Settings</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/900-errors.html">Errors</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/910-warnings.html">Warnings</a>
	  	
  	
		
			<li><a href="/releases/5.0.0/chapters/920-faq.html">Frequently Asked Questions</a>
	  	
  	
</ul>

			</div>
			
		<li span=9>
			<div class=notes-margin>
				<h1> SPI Annotations</h1>
				<p>Writing Java libraries which support <strong>OSGi</strong> does not typically require more than generating proper OSGi metadata. <strong>bnd</strong> helps accomplish with minimal effort on the part of developers. One issue that remains somewhat complex is properly handling the use of the <a href="https://docs.oracle.com/javase/tutorial/ext/basics/spi.html">Java SPI</a> such that it works seamlessly in OSGi and avoiding the need for custom code to accomplish a similar goal. OSGi defines the <a href="https://osgi.org/specification/osgi.cmpn/7.0.0/service.loader.html">Service Loader Mediator Specification</a> but applying it requires a significant amount of manifest metadata.</p>

<h2 id="spi-annotations">SPI Annotations</h2>

<p>bnd defines a set of <em>SPI annotations</em> which provide a simple solution for developers who wish to maintain OSGi friendly libraries.</p>

<h3 id="serviceconsumer">@ServiceConsumer</h3>

<p>The Java SPI use cases are broken into two groups; providers and consumers. The <code class="highlighter-rouge">@aQute.bnd.annotation.spi.ServiceConsumer</code> annotation is used in consumer code to express a requirement on an SPI service type adding the appropriate OSGi metadata to the manifest.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ServiceConsumer</span><span class="o">(</span>
    <span class="n">value</span> <span class="o">=</span> <span class="nc">JsonProvider</span><span class="o">.</span><span class="na">class</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">JsonProvider</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">JsonProvider</span> <span class="nf">provider</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">JsonProvider</span> <span class="n">provider</span> <span class="o">:</span> <span class="nc">ServiceLoader</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="nc">JsonProvider</span><span class="o">.</span><span class="na">class</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">provider</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">JsonException</span><span class="o">(</span><span class="s">"provider not found"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">@ServiceConsumer</code> also grants the developer control in defining many facets of the generated OSGi requirements such as <code class="highlighter-rouge">cardinality</code>, <code class="highlighter-rouge">effective</code> time and <code class="highlighter-rouge">resolution</code>.</p>

<h3 id="serviceprovider">@ServiceProvider</h3>

<p>The provider side is supported by the <code class="highlighter-rouge">@aQute.bnd.annotation.spi.ServiceProvider</code> annotation. It is used to express a capability for a given SPI service type adding all the appropriate OSGi manifest metadata.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ServiceProvider</span><span class="o">(</span><span class="nc">JsonProvider</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JsonProviderImpl</span> <span class="kd">extends</span> <span class="nc">JsonProvider</span> <span class="o">{</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">@ServiceProvider</code> also grants the developer control in defining many facets of the generated OSGi requirements and capabilities such as additional attributes and directives (attributes becoming service properties), <code class="highlighter-rouge">cardinality</code>, <code class="highlighter-rouge">effective</code> time, <code class="highlighter-rouge">resolution</code>, and package <code class="highlighter-rouge">uses</code>.</p>

<h4 id="osgi-services">OSGi Services</h4>

<p>The <code class="highlighter-rouge">@ServiceProvider</code> annotation will automatically result in publishing OSGi services for each provider discovered. Any attributes (excluding directives) specified on the annotation will be automatically added as OSGi service properties.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ServiceProvider</span><span class="o">(</span>
    <span class="n">value</span> <span class="o">=</span> <span class="nc">JsonProvider</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
    <span class="n">attribute</span> <span class="o">=</span> <span class="o">{</span>
        <span class="s">"colors:List&lt;String&gt;='blue,green,red'"</span>
    <span class="o">}</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JsonProviderImpl</span> <span class="kd">extends</span> <span class="nc">JsonProvider</span> <span class="o">{</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>An <code class="highlighter-rouge">osgi.service</code> capability is also generated for each provider type.</p>

<h4 id="service-descriptor-files">Service Descriptor Files</h4>

<p>An additional feature provided by bnd is the ability to manage the service descriptor files (a.k.a. <code class="highlighter-rouge">META-INF/services/*</code>) automatically for any <code class="highlighter-rouge">osgi.serviceloader</code> capabilities it finds having the <code class="highlighter-rouge">register:</code> directive containing a providerâ€™s fully qualified class name. The <code class="highlighter-rouge">register:</code> directive is automatically generated from all instances of <code class="highlighter-rouge">@ServiceProvider</code>.</p>


			</div>
	</ul>

	
<nav class=next-prev>
	<a href='/releases/5.0.0/chapters/235-accessor-properties.html'></a> <a href='/releases/5.0.0/chapters/250-resolving.html'></a>
</nav>
<footer class="container12" style="border-top: 1px solid black;padding:10px 0">
	<ul span=12 row>
		<li span=12>
			<ul>
				<li><a href="/releases/5.0.0/">GitHub</a>
			</ul>
	</ul>
</footer>

</body>
</html>
