<!DOCTYPE html>
<html lang="en" ng-app="jpm">

	<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="/releases/6.3.0/css/style.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="/js/releases.js"></script>

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>-buildtool toolspec (EXPERIMENTAL!) | bnd</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="-buildtool toolspec (EXPERIMENTAL!)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In many projects, the workspace carries the files to build it with an external tool. Gradle is the most popular but it is also possible to use other tools. An advantage of the workspace is that there are no specific setups required, the workspace contains all the information needed to build. For example, the bnd command line can build it. Tools are generally used to provide additional tasks." />
<meta property="og:description" content="In many projects, the workspace carries the files to build it with an external tool. Gradle is the most popular but it is also possible to use other tools. An advantage of the workspace is that there are no specific setups required, the workspace contains all the information needed to build. For example, the bnd command line can build it. Tools are generally used to provide additional tasks." />
<meta property="og:site_name" content="bnd" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="-buildtool toolspec (EXPERIMENTAL!)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"In many projects, the workspace carries the files to build it with an external tool. Gradle is the most popular but it is also possible to use other tools. An advantage of the workspace is that there are no specific setups required, the workspace contains all the information needed to build. For example, the bnd command line can build it. Tools are generally used to provide additional tasks.","headline":"-buildtool toolspec (EXPERIMENTAL!)","url":"/releases/6.3.0/instructions/buildtool.html"}</script>
<!-- End Jekyll SEO tag -->


	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

</head>


<body>

	
<ul class="container12 menu-bar" style="display:flex;align-items:center">
	<li span=8><a class=menu-link href="/releases/6.3.0/"><img
			class=menu-logo src="/releases/6.3.0/img/bnd-80x40-white.png"></a>
			<a href="/releases/6.3.0/chapters/110-introduction.html">Intro
			</a><a href="/releases/6.3.0/chapters/800-headers.html">Headers
			</a><a href="/releases/6.3.0/chapters/825-instructions-ref.html">Instructions
			</a><a href="/releases/6.3.0/chapters/855-macros-ref.html">Macros
			</a><a href="/releases/6.3.0/chapters/400-commands.html">Commands
			</a><div class="releases">
			         <button class="dropbtn"><span class="fa fa-bars"></span> 6.3.0</button>
			         <div class="dropdown-content"></div>
			   </div>
    <li span=4>     
        <div class="search-container">
			<form method="get" id="search" action="https://google.com/search" target="_blank">
			    <input type="hidden" name="as_q" value="site:bndtools.org OR site:bnd.discourse.group"/>
			    <input type="text" name="q" placeholder="Search…" aria-label="Search https://google.com for bnd specific"/>
			    <button type="submit" class="fa fa-search"></button>
            </form>
       </div>
</ul>
<div class=menu-link span=0><a href="https://github.com/bndtools/bnd" target="_"><img
	style="position:absolute;top:0;right:0;margin:0;padding:0;z-index:100"
	src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67"
	alt="Fork me on GitHub"
	data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a></div>



					

	<ul class=container12>
		<li span=3>
			<div>
			<ul class="side-nav">
	
		
			<li><a href="/releases/6.3.0/chapters/110-introduction.html">Introduction</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/120-install.html">How to install bnd</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/123-tour-workspace.html">Guided Tour</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/125-tour-features.html">Guided Tour Workspace & Projects</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/130-concepts.html">Concepts</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/140-best-practices.html">Best practices</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/150-build.html">Build</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/155-project-setup.html">Project Setup</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/160-jars.html">Generating JARs</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/170-versioning.html">Versioning</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/180-baselining.html">Baselining</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/200-components.html">Service Components</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/210-metatype.html">Metatype</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/220-contracts.html">Contracts</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/230-manifest-annotations.html">Bundle Annotations</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/235-accessor-properties.html">Accessor Properties</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/240-spi-annotations.html">SPI Annotations</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/250-resolving.html">Resolving Dependencies</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/300-launching.html">Launching</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/305-startlevels.html">Startlevels</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/310-testing.html">Testing</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/315-launchpad-testing.html">Testing with Launchpad</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/320-packaging.html">Packaging Applications</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/330-jpms.html">JPMS Libraries</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/390-wrapping.html">Wrapping Libraries to OSGi Bundles</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/395-generating-documentation.html">Generating Documentation</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/400-commands.html">Commands</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/600-developer.html">For Developers</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/650-windows.html">Tips for Windows users</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/700-tools.html">Tools bound to bnd</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/790-reference.html">Reference</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/800-headers.html">Headers</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/820-instructions.html">Instruction Reference</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/825-instructions-ref.html">Instruction Index</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/850-macros.html">Macro Reference</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/855-macros-ref.html">Macro Index</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/870-plugins.html">Plugins</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/875-external-plugins.html">External Plugins</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/880-settings.html">Settings</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/900-errors.html">Errors</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/910-warnings.html">Warnings</a>
	  	
  	
		
			<li><a href="/releases/6.3.0/chapters/920-faq.html">Frequently Asked Questions</a>
	  	
  	
</ul>

			</div>
			
		<li span=9>
			<div class=notes-margin>
			
				<h1> -buildtool  toolspec  (EXPERIMENTAL!)               
                 <div class="pageclass" onclick="window.location.href='/chapters/790-reference.html';">
                     bnd
                   </div>
                     
				</h1>
				<p>In many projects, the workspace carries the files to build it with an external tool. Gradle is the most
popular but it is also possible to use other tools. An advantage of the workspace is that there are
no specific setups required, the workspace contains all the information needed to build. For example,
the bnd command line can build it. Tools are generally used to provide additional tasks.</p>

<p>The setup files of the build tool therefore tend to be dead weight. Dead weight, that frequently needs
overlapping properties with the bnd workspace. Since the tools tend get updated frequently, there are
many software engineering advantages in installing the build tool before the project is being built. It
also makes it easier to maintain many different workspace, they no longer need to be updated when a
new release becomes available. Only the workspace <code class="language-plaintext highlighter-rouge">cnf/build.bnd</code> needs to be maintained.</p>

<h2 id="github-actions">Github Actions</h2>

<p>TBD: a github action that will run the bnd command is foreseen</p>

<h2 id="-buildtool-instruction">-buildtool instruction</h2>

<p>The <code class="language-plaintext highlighter-rouge">-buildtool</code> instruction provides the information for the bnd command line tool to install a
build tool template from the net. It has the following attributes:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">version</code> – If the <code class="language-plaintext highlighter-rouge">version</code> is an OSGi version, the key <em>must</em> be a tool name, for example <code class="language-plaintext highlighter-rouge">gradle</code>. The url used
to download the template will then be constructed of a url to 
     <code class="language-plaintext highlighter-rouge">https://github.com/bndtools/workspace.tool.${key}/archive/refs/tags/${version}.zip</code></p>

    <p>If it is not a version, it can be:</p>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">url</code> – The key is interpreted as a URL to a template zip file.</li>
      <li><code class="language-plaintext highlighter-rouge">file</code> – The key is interpreted to a file local to the root of the workspace</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">*</code> – Any other attributes will be expanded in a properties file</p>
  </li>
</ul>

<h2 id="template">Template</h2>

<p>The template zip must contain a <code class="language-plaintext highlighter-rouge">tool.bnd</code> file. This file describes how the template should be installed. This file
can be anywhere in the zip hierarchy, its parent directory is the <em>root</em>. Only files from the <em>root</em> will be copied.</p>

<p>The <code class="language-plaintext highlighter-rouge">tool.bnd</code> file must contain a <code class="language-plaintext highlighter-rouge">-tool</code> instruction.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-tool \
    .*;tool.bnd;skip=true, \
    gradle.properties;macro=true,\
    gradlew;exec=true, \
    *
</code></pre></div></div>

<p>This is a normal <em>instructions</em>. The keys are matched against the file names relative from the <em>root</em>. The first matching
instruction, provides the instructions how to process the file. The following attributes are available.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">skip=*</code> : Skip these files</li>
  <li><code class="language-plaintext highlighter-rouge">macro=*</code> : Process macros. The macros can use the workspace macros and any macros specified in the <code class="language-plaintext highlighter-rouge">tool.bnd</code> file.</li>
  <li><code class="language-plaintext highlighter-rouge">append=*</code> : Append the extra attributes of the <code class="language-plaintext highlighter-rouge">-buildtool</code> instruction to the matching files. This will happen in the format of bnd/properties files.</li>
  <li><code class="language-plaintext highlighter-rouge">exec=*</code> : Make the file executable for the owner</li>
</ul>

<p>The attributes <em>must</em> have a value, this value is ignored.</p>

<h2 id="example">Example</h2>

<p>We want to use Gradle 7.3 with bnd 6.1.0. We therefore add the following to the bnd workspace <code class="language-plaintext highlighter-rouge">cnf/build</code> file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-buildtool \
    gradle; version=7.3.0; \
    bnd_version = 6.1.0
    bnd_snapshot=https://bndtools.jfrog.io/bndtools/libs-snapshot-local
</code></pre></div></div>

<p>To install the tool, you can execute the bnd command <code class="language-plaintext highlighter-rouge">buildtool</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ bnd buildtool --force
</code></pre></div></div>

<p>This will download the sources at <code class="language-plaintext highlighter-rouge">https://github.com/bndtools/workspace.tool.gradle/archive/refs/heads/7.3.0.zip</code>. The zip file
looks something like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>workspace.tool.gradle/
    tool.bnd
    gradle/
        wrapper/
            gradle-wrapper.jar
            gradle-wrapper.properties
    gradle.properties
    settings.gradle
    gradlew.bat
    gradlew
    .gitignore
</code></pre></div></div>

<p>The  <code class="language-plaintext highlighter-rouge">tool.bnd</code> looks like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-tool \
    .*;tool.bnd;skip=true, \
    gradle.properties;macro=true,\
    gradlew;exec=true, \
    *
</code></pre></div></div>

<p>It should be clear that the <code class="language-plaintext highlighter-rouge">gradle.properties</code> is expanded. After the files are copied, it looks like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Appended by tool manager at 2021-12-02T14:40:55.660843Z
version = url
bnd_version = 6.1.0
bnd_snapshots = https://bndtools.jfrog.io/bndtools/libs-snapshot-local
</code></pre></div></div>

<p>After the command has finished, the gradle command can be executed</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./gradlew --parallel clean build
</code></pre></div></div>


			</div>
	</ul>

	
<nav class=next-prev>
	<a href='/releases/6.3.0/instructions/buildrepo.html'></a> <a href='/releases/6.3.0/instructions/bumpolicy.html'></a>
</nav>
<footer class="container12" style="border-top: 1px solid black;padding:10px 0">
	<ul span=12 row>
		<li span=12>
			<ul>
				<li><a href="/releases/6.3.0/">GitHub</a>
			</ul>
	</ul>
</footer>

</body>
</html>
