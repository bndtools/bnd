<!DOCTYPE html>
<html lang="en" ng-app="jpm">

	<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="/releases/4.1.0/css/style.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="/js/releases.js"></script>
<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Apache Felix Maven Bundle Plugin</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Apache Felix Maven Bundle Plugin" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="One set of developers comes from the Maven world and is generally happy with the “Maven Way”; they do not want it to change significantly. We feel that these users are already well served by the Apache Felix Maven Bundle Plugin, m2eclipse and even other IDEs such as NetBeans. We call the above a “Maven first” approach. bndlib supports this approach with the Apache Felix Maven Bundle plugin. This plugin is maintained by the Apache Felix project the plugin is well documented there. This document shamelessly copies some of this information." />
<meta property="og:description" content="One set of developers comes from the Maven world and is generally happy with the “Maven Way”; they do not want it to change significantly. We feel that these users are already well served by the Apache Felix Maven Bundle Plugin, m2eclipse and even other IDEs such as NetBeans. We call the above a “Maven first” approach. bndlib supports this approach with the Apache Felix Maven Bundle plugin. This plugin is maintained by the Apache Felix project the plugin is well documented there. This document shamelessly copies some of this information." />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-10-12T20:06:21-04:00" />
<script type="application/ld+json">
{"headline":"Apache Felix Maven Bundle Plugin","dateModified":"2019-10-12T20:06:21-04:00","datePublished":"2019-10-12T20:06:21-04:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"/releases/4.1.0/tools/felix-maven.html"},"url":"/releases/4.1.0/tools/felix-maven.html","description":"One set of developers comes from the Maven world and is generally happy with the “Maven Way”; they do not want it to change significantly. We feel that these users are already well served by the Apache Felix Maven Bundle Plugin, m2eclipse and even other IDEs such as NetBeans. We call the above a “Maven first” approach. bndlib supports this approach with the Apache Felix Maven Bundle plugin. This plugin is maintained by the Apache Felix project the plugin is well documented there. This document shamelessly copies some of this information.","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->






































































</head>


<body>


<ul class="container12 menu-bar">
	<li span=11><a class=menu-link href="/releases/4.1.0/"><img
			class=menu-logo src='/releases/4.1.0/img/bnd-80x40-white.png'></a>
			<a href="/releases/4.1.0/chapters/110-introduction.html">Intro
			</a><a href="/releases/4.1.0/chapters/800-headers.html">Headers
			</a><a href="/releases/4.1.0/chapters/825-instructions-ref.html">Instructions
			</a><a href="/releases/4.1.0/chapters/855-macros-ref.html">Macros
			</a><a href="/releases/4.1.0/chapters/860-commands.html">Commands
			</a><div class="releases"><button class="dropbtn">4.1.0</button><div class="dropdown-content"></div></div>

	<li class=menu-link span=1>
			<a href="https://github.com/bndtools/bnd" target="_"><img
	style="position:absolute;top:0;right:0;margin:0;padding:0;z-index:100"
	src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67"
	alt="Fork me on GitHub"
	data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
</ul>




	<ul class=container12>
		<li span=3>
			<div>
			<ul class="side-nav">


			<li><a href="/releases/4.1.0/chapters/110-introduction.html">Introduction</a>



			<li><a href="/releases/4.1.0/chapters/120-install.html">How to install bnd</a>



			<li><a href="/releases/4.1.0/chapters/123-tour-workspace.html">Guided Tour</a>



			<li><a href="/releases/4.1.0/chapters/125-tour-features.html">Guided Tour Workspace & Projects</a>



			<li><a href="/releases/4.1.0/chapters/130-concepts.html">Concepts</a>



			<li><a href="/releases/4.1.0/chapters/140-best-practices.html">Best practices</a>



			<li><a href="/releases/4.1.0/chapters/150-build.html">Build</a>



			<li><a href="/releases/4.1.0/chapters/160-jars.html">Generating JARs</a>



			<li><a href="/releases/4.1.0/chapters/170-versioning.html">Versioning</a>



			<li><a href="/releases/4.1.0/chapters/180-baselining.html">Baselining</a>



			<li><a href="/releases/4.1.0/chapters/200-components.html">Service Components</a>



			<li><a href="/releases/4.1.0/chapters/210-metatype.html">Metatype</a>



			<li><a href="/releases/4.1.0/chapters/220-contracts.html">Contracts</a>



			<li><a href="/releases/4.1.0/chapters/230-manifest-annotations.html">Manifest Annotations</a>



			<li><a href="/releases/4.1.0/chapters/250-resolving.html">Resolving Dependencies</a>



			<li><a href="/releases/4.1.0/chapters/300-launching.html">Launching</a>



			<li><a href="/releases/4.1.0/chapters/310-testing.html">Testing</a>



			<li><a href="/releases/4.1.0/chapters/320-packaging.html">Packaging Applications</a>



			<li><a href="/releases/4.1.0/chapters/390-wrapping.html">Wrapping Libraries to OSGi Bundles</a>



			<li><a href="/releases/4.1.0/chapters/400-commandline.html">From the command line</a>



			<li><a href="/releases/4.1.0/chapters/600-developer.html">For Developers</a>



			<li><a href="/releases/4.1.0/chapters/610-plugin.html">Plugins</a>



			<li><a href="/releases/4.1.0/chapters/700-tools.html">Tools bound to bnd</a>



			<li><a href="/releases/4.1.0/chapters/800-headers.html">Header Reference</a>



			<li><a href="/releases/4.1.0/chapters/820-instructions.html">Instruction</a>



			<li><a href="/releases/4.1.0/chapters/825-instructions-ref.html">Instruction Index</a>



			<li><a href="/releases/4.1.0/chapters/850-macros.html">Macro Reference</a>



			<li><a href="/releases/4.1.0/chapters/855-macros-ref.html">Macro Index</a>



			<li><a href="/releases/4.1.0/chapters/860-commands.html">Command Reference</a>



			<li><a href="/releases/4.1.0/chapters/870-plugins.html">Plugins Reference</a>



			<li><a href="/releases/4.1.0/chapters/880-settings.html">Settings</a>



			<li><a href="/releases/4.1.0/chapters/900-errors.html">Errors</a>



			<li><a href="/releases/4.1.0/chapters/910-warnings.html">Warnings</a>



			<li><a href="/releases/4.1.0/chapters/920-faq.html">Frequently Asked Questions</a>


</ul>

			</div>

		<li span=9>
			<div class=notes-margin>
				<h1> Apache Felix Maven Bundle Plugin</h1>
				<p>One set of developers comes from the Maven world and is generally happy with the “Maven Way”; they do not want it to change significantly. We feel that these users are already well served by the Apache Felix Maven Bundle Plugin, m2eclipse and even other IDEs such as NetBeans.  We call the above a “Maven first” approach. bndlib supports this approach with the Apache Felix Maven Bundle plugin. This plugin is maintained by the Apache Felix project the plugin is <a href="http://felix.apache.org/site/apache-felix-maven-bundle-plugin-bnd.html">well documented there</a>. This document shamelessly copies some of this information.</p>

<p>The Apache Felix Maven Bundle plugin uses bndlib only to create a manifest; it does not support the bndlib’s workspace and project model. This means that not all instructions and macros are relevant.</p>

<p>The Apache Felix Maven Bundle plugin maps the bndlib instructions to XML elements in the POM in the configuration part of the plugin, bndlib is then called to create the manifest for the JAR. Before the Apache Felix Maven Bundle Plugin calls bndlib, it sets up the class path and provides a number of defaults that differ from the standard bndlib defaults. These changes will be discussed later.</p>

<h2 id="simple-example">Simple Example</h2>

<p>Rather than going straight to a detailed list of plugin features, we will first look at a simple example of how to use the plugin to give an immediate flavor. A detailed “how to” will follow. Assume that we have a simple bundle project that has a pubic API package an several implementation packages, such as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>com.acme.prime.speaker.api
com.acme.prime.speaker.provider
com.acme.prime.speaker.provider.mac
com.acme.prime.speaker.provider.unix
com.acme.prime.speaker.provider.windows
</code></pre></div></div>

<p>If we also assume that we have a bundle activator in one of the implementation packages, then the <code class="highlighter-rouge">&lt;plugins&gt;</code> section of the POM file for this bundle project would look like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;plugin&gt;
    &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;
    &lt;artifactId&gt;maven-bundle-plugin&lt;/artifactId&gt;
    &lt;extensions&gt;true&lt;/extensions&gt;
    &lt;configuration&gt;
      &lt;instructions&gt;
        &lt;Export-Package&gt;com.acme.prime.speaker.api&lt;/Export-Package&gt;
        &lt;Private-Package&gt;com.acme.prime.speaker.provider.*&lt;/Private-Package&gt;
        &lt;_dsannotations&gt;*&lt;/_dsannotations&gt;
      &lt;/instructions&gt;
    &lt;/configuration&gt;
  &lt;/plugin&gt;
</code></pre></div></div>

<h2 id="instructions-macros--name-mangling">Instructions, Macros &amp; Name Mangling</h2>

<p>It should be clear that the Apache Felix Maven Bundle plugin uses the XML tag names in the configuration for the headers and instructions. Since the name of most instructions start with a minus sign (‘-‘), which is not allowed in XML, the first minus sign is replaced with an underscore (‘_’). Most instructions and macros can be used except for the  project/workspace instructions since these concepts are available from Maven. Such project instructions and macros are indicated on their reference pages.</p>

<p>As always in bndlib, any element starting with an upper case us copied to the manifest, all other elements are internal to bnd; they are available as macros and might indicate instructions to bnd (which mostly start with a minus sign).</p>

<p>You can use macros but you must be careful to avoid conflicting with the macros used in the POM that also use the <code class="highlighter-rouge">${...}</code> pattern; it is therefore necessary for bnd to use one of its alternative patterns, for example <code class="highlighter-rouge">$[...]</code>. The maven POM macros are fortunately already expanded before bndlib sees them.</p>

<p>Since all elements become part of the bndlib properties you can actually also set macros for later use:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;instructions&gt;
    &lt;opt&gt;resolution:=optional&lt;/opt&gt;
    &lt;Import-Package&gt;org.slf4j;$[opt], *&lt;/Import-Package&gt;
  &lt;/instructions&gt;
</code></pre></div></div>

<h2 id="embed-dependency">Embed-Dependency</h2>

<p>The Apache Felix Maven Bundle plugin supports a special instruction <Embed-Dependency> that will automatically include maven transitive dependencies in the JAR and place these JARs on the Bundle-ClassPath. This feature is explained in [Embedding Dependencies][2].</Embed-Dependency></p>

<blockquote>
  <p>This is a convenient feature that is not so wise to use since it makes the actual bundle depending on many aspects that are not under direct control. A bundle is a component and should reflect an implementation of a public API; this model requires that you think about what goes in there and what does not go in there. Adding transitive dependencies inside this bundle tends to create very complex systems that destroy the benefits of OSGi.</p>
</blockquote>

<h2 id="defaults">Defaults</h2>

<p>To use this plugin, very little information is required by bndlib. As part of the Maven integration, the plugin tries to set reasonable defaults based on the POM for various instructions.</p>

<p>Default Headers:</p>

 	 Bundle-SymbolicName: <groupId>.<artifactId>
</artifactId></groupId><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Bundle-Name:         project.getName();
 Bundle-Version:      normalized pom &lt;version&gt;
 Import-Package:      *
 Export-Package:      all packages except packages with impl/internal in their name
 Bundle-Description:  project.getDescription()
 Bundle-License:      project.getLicenses())
 Bundle-Vendor:       project.getOrganization().getName();
 Bundle-DocURL:       project.getOrganization().getUrl()
 Include-Resource:    src/main/resources
</code></pre></div></div>

<p>Special Macros:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>${bundle-symbolicname}
${local-packages}
</code></pre></div></div>

<h3 id="bundle-symbolic-name">Bundle Symbolic Name</h3>

<p>The <Bundle-SymbolicName> is computed using the shared Maven2OsgiConverter component, which uses the following algorithm:</Bundle-SymbolicName></p>

<ul>
  <li>Get the symbolic name as groupId + “.” + artifactId, with the following exceptions:
    <ul>
      <li>If artifact.getFile is not null and the jar contains a OSGi Manifest with Bundle-SymbolicName property then that value is returned</li>
      <li>If groupId has only one section (no dots) and artifact.getFile is not null then the first package name with classes is returned. eg. commons-logging:commons-logging -&gt; org.apache.commons.logging</li>
      <li>If artifactId is equal to last section of groupId then groupId is returned. eg. org.apache.maven:maven -&gt; org.apache.maven</li>
      <li>if artifactId starts with last section of groupId that portion is removed. eg. org.apache.maven:maven-core -&gt; org.apache.maven.core</li>
    </ul>
  </li>
</ul>

<p>The computed symbolic name is also stored in the $[maven-symbolicname] property in case you want to add attributes or directives to it.</p>

<h3 id="export-package">Export Package</h3>

<p>Export-Package is assumed to be the set of packages in your local Java sources, excluding the default package ‘.’ and any packages containing ‘impl’ or ‘internal’. (before version 2 of the bundleplugin it was based on the symbolic name)</p>

<blockquote>
  <p>From a bndlib perspective, this is the wrong default. An exported package is an expensive thing to have and the philosophy of bndlib is to make these expensive choices explicit, this is the reason the bndlib default is to make nothing exported, especially because good bundles should have no or very few exports.</p>
</blockquote>

<h2 id="detailed-how-to">Detailed “How To”</h2>

<p>To use the maven-bundle-plugin, you first need to add the plugin and some appropriate plugin configuration to your bundle project’s POM. Below is an example of a simple OSGi bundle POM for Maven2:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;my-osgi-bundles&lt;/groupId&gt;
  &lt;artifactId&gt;examplebundle&lt;/artifactId&gt;
  &lt;packaging&gt;bundle&lt;/packaging&gt;    &lt;!-- (1) --&gt;
  &lt;version&gt;1.0&lt;/version&gt;
  &lt;name&gt;Example Bundle&lt;/name&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;
      &lt;artifactId&gt;org.osgi.core&lt;/artifactId&gt;
      &lt;version&gt;1.0.0&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;    &lt;!-- (2) START --&gt;
        &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;
        &lt;artifactId&gt;maven-bundle-plugin&lt;/artifactId&gt;
        &lt;extensions&gt;true&lt;/extensions&gt;
        &lt;configuration&gt;
          &lt;instructions&gt;
            &lt;Export-Package&gt;com.my.company.api&lt;/Export-Package&gt;
            &lt;Private-Package&gt;com.my.company.*&lt;/Private-Package&gt;
            &lt;Bundle-Activator&gt;com.my.company.Activator&lt;/Bundle-Activator&gt;
          &lt;/instructions&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;    &lt;!-- (2) END --&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;
</code></pre></div></div>

<p>There are two main things to note: (1) the <packaging> specifier must be `bundle` and (2) the plugin and configuration must be specified (the configuration section is where you will issue instructions to the plugin).</packaging></p>

<h2 id="real-world-example">Real-World Example</h2>

<p>Consider this more real-world example using Felix’ Log Service implementation. The Log Service project is comprised of a single package: org.apache.felix.log.impl. It has a dependency on the core OSGi interfaces as well as a dependency on the compendium OSGi interfaces for the specific log service interfaces. The following is its POM file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;
  &lt;artifactId&gt;org.apache.felix.log&lt;/artifactId&gt;
  &lt;packaging&gt;bundle&lt;/packaging&gt;
  &lt;name&gt;Apache Felix Log Service&lt;/name&gt;
  &lt;version&gt;0.8.0-SNAPSHOT&lt;/version&gt;
  &lt;description&gt;
    This bundle provides an implementation of the OSGi R4 Log service.
  &lt;/description&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;${pom.groupId}&lt;/groupId&gt;
      &lt;artifactId&gt;org.osgi.core&lt;/artifactId&gt;
      &lt;version&gt;0.8.0-incubator&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;${pom.groupId}&lt;/groupId&gt;
      &lt;artifactId&gt;org.osgi.compendium&lt;/artifactId&gt;
      &lt;version&gt;0.9.0-incubator-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;
        &lt;artifactId&gt;maven-bundle-plugin&lt;/artifactId&gt;
        &lt;extensions&gt;true&lt;/extensions&gt;
        &lt;configuration&gt;
          &lt;instructions&gt;
            &lt;Export-Package&gt;org.osgi.service.log&lt;/Export-Package&gt;
            &lt;Private-Package&gt;org.apache.felix.log.impl&lt;/Private-Package&gt;
            &lt;Bundle-SymbolicName&gt;${pom.artifactId}&lt;/Bundle-SymbolicName&gt;
            &lt;Bundle-Activator&gt;${pom.artifactId}.impl.Activator&lt;/Bundle-Activator&gt;
            &lt;Export-Service&gt;org.osgi.service.log.LogService,org.osgi.service.log.LogReaderService&lt;/Export-Service&gt;
          &lt;/instructions&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;
</code></pre></div></div>

<p>This will create a manifest of:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Manifest-Version: 1
Bundle-License: http://www.apache.org/licenses/LICENSE-2.0.txt
Bundle-Activator: org.apache.felix.log.impl.Activator
Import-Package: org.osgi.framework;version=1.3, org.osgi.service.log;v
 ersion=1.3
Include-Resource: src/main/resources
Export-Package: org.osgi.service.log;uses:=org.osgi.framework;version=
 1.3
Bundle-Version: 0.8.0.SNAPSHOT
Bundle-Name: Apache Felix Log Service
Bundle-Description: This bundle provides an implementation of the OSGi
  R4 Log service.
Private-Package: org.apache.felix.log.impl
Bundle-ManifestVersion: 2
Export-Service: org.osgi.service.log.LogService,org.osgi.service.log.L
 ogReaderService
Bundle-SymbolicName: org.apache.felix.log
The resulting bundle JAR file has the following content (notice how the LICENSE and NOTICE files were automatically copied from the src/main/resources/ directory of the project):
</code></pre></div></div>

<p>If you want to keep your project packaging type (for example “jar”) but would like to add OSGi metadata
you can use the manifest goal to generate a bundle manifest. The maven-jar-plugin can then be used to
add this manifest to the final artifact. For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;plugin&gt;
  &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
  &lt;configuration&gt;
    &lt;archive&gt;
      &lt;manifestFile&gt;${project.build.outputDirectory}/META-INF/MANIFEST.MF&lt;/manifestFile&gt;
    &lt;/archive&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;
&lt;plugin&gt;
  &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;
  &lt;artifactId&gt;maven-bundle-plugin&lt;/artifactId&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;bundle-manifest&lt;/id&gt;
      &lt;phase&gt;process-classes&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;manifest&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;
</code></pre></div></div>

<p>If you want to use packaging types other than “jar” and “bundle” then you also need to enable support
for them in the bundleplugin configuration, for example if you want to use the plugin with WAR files:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;plugin&gt;
  &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;
  &lt;artifactId&gt;maven-bundle-plugin&lt;/artifactId&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;bundle-manifest&lt;/id&gt;
      &lt;phase&gt;process-classes&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;manifest&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
  &lt;configuration&gt;
    &lt;supportedProjectTypes&gt;
      &lt;supportedProjectType&gt;jar&lt;/supportedProjectType&gt;
      &lt;supportedProjectType&gt;bundle&lt;/supportedProjectType&gt;
      &lt;supportedProjectType&gt;war&lt;/supportedProjectType&gt;
    &lt;/supportedProjectTypes&gt;
    &lt;instructions&gt;
      &lt;!-- ...etc... --&gt;
    &lt;/instructions&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;
</code></pre></div></div>

<p>You’ll also need to configure the other plugin to pick up and use the generated manifest, which is written to ${project.build.outputDirectory}/META-INF/MANIFEST.MF by default (unless you choose a different manifestLocation in the maven-bundle-plugin configuration). Continuing with our WAR example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;plugin&gt;
  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
  &lt;configuration&gt;
    &lt;archive&gt;
      &lt;manifestFile&gt;${project.build.outputDirectory}/META-INF/MANIFEST.MF&lt;/manifestFile&gt;
    &lt;/archive&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;
</code></pre></div></div>

<h2 id="using-the-workspaceproject-facilities">Using the Workspace/Project facilities</h2>

<p>Though the Apache Felix Maven Bundle plugin is used in a ‘maven first’ model, it can actually also be used with some of the benefits of using bndlib more direct so that for example bndtools can be used. In this model, the POM includes a bnd file that is also used by bnd(tools). This is far from perfect since it will be necessary to maintain the classpath in two different places: through the transitive dependencies in the POM and in bnd. It will also not provide full fidelity between the maven build and the IDE build since other plugins in maven are ignored. However, it will allow the use of bndtools as the primary IDE, which allows you to develop bundles faster than any other environment.</p>

<p>If you want to use this model, be aware that bnd has a strict disk layout for the workspace. A workspace is a directory with a <code class="highlighter-rouge">cnf</code> directory and project directory. It is not possible to create arbitrary layouts. For maven, the disk layout should be:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ./com.acme.prime/                workspace
    cnf/                           configuration
      ext/                         extensions
        maven.bnd                  contains the maven plugin setup
      build.bnd                    your shared settings
    pom.xml                        maven modules POM
    com.acme.prime.speaker.api/    project directory
      pom.xml                      your project POM
      src/                         maven source directory
        main/
          java/
        test/
          java/
      target/
        classes/                   output directory
        test-classes/              test output
</code></pre></div></div>

<p>You can include files with the -include instruction:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;instructions&gt;
    &lt;_include&gt;bnd.bnd&lt;/_include&gt;
  &lt;/instructions&gt;
</code></pre></div></div>

<p>Now you can add the instruction in the <code class="highlighter-rouge">bnd.bnd</code> file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Export-Package: com.acme.prime.speaker.api
Private-Package: com.acme.prime.speaker.provider.*
-dsannotations: true
</code></pre></div></div>

<p>The easiest way to setup such a workspace is is by adding the bnd maven plugin:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ bnd add workspace com.acme.prime
$ cd com.acme.prime
$ bnd add plugin maven
</code></pre></div></div>

<p>The bnd maven plugin will automatically maintain a pom.xml in the workspace containing the workspace projects.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ bnd add project com.acme.speaker.api
$ more pom.xml
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;/Users/aqute/tmp/com.acme.prime&lt;/groupId&gt;
    &lt;artifactId&gt;root&lt;/artifactId&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;

    &lt;modules&gt;
    &lt;!-- DO NOT EDIT MANAGED BY BND MAVEN LIFECYCLE PLUGIN --&gt;
        &lt;module&gt;com.acme.prime.speaker.api&lt;/module&gt;
    &lt;/modules&gt;
&lt;/project&gt;
</code></pre></div></div>

<p>You can edit this file to add more specific information, the bnd maven plugin will only change the marked part.</p>

<p>The maven bnd plugin also changes the file layout to match the default maven file layout. Take a look at <code class="highlighter-rouge">cnf/ext/maven.bnd</code> for the details.</p>

<h2 id="links">Links</h2>

<ul>
  <li><a href="http://davidvaleri.wordpress.com/2011/04/07/secrets-of-the-felix-bundle-plug-in-macros-revealed/">Secrets of the Apache Felix Bundle Plugin Revealed</a> – Interesting blog about using the bndlib macros inside the plugin to handle semantic versioning</li>
</ul>


			</div>
	</ul>


<nav class=next-prev>
	<a href='/releases/4.1.0/tools/bndtools-eclipse.html'></a> <a href='/releases/4.1.0/tools/gradle-bundle-plugin.html'></a>
</nav>
<footer class="container12" style="border-top: 1px solid black;padding:10px 0">
	<ul span=12 row>
		<li span=3>
			<ul>
				<li><a href="/releases/4.1.0/contact.html">Contact</a>
			</ul>
		<li span=3>
			<ul>
				<li><a href="/releases/4.1.0/">Developers</a>
			</ul>
		<li span=3>
			<ul>
				<li><a href="/releases/4.1.0/">More</a>
			</ul>
	</ul>
</footer>

</body>
</html>
