<!DOCTYPE html>
<html lang="en" ng-app="jpm">

	<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="/releases/4.2.0/css/style.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="/js/releases.js"></script>
<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>range ‘;’ RANGE_MASK ( ‘;’ VERSION )</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="range ‘;’ RANGE_MASK ( ‘;’ VERSION )" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The range macro takes a version range mask/template and uses it calculate a range from a given version. The primary reason for the ${range} macro is to be used in the version policy. With the version policy we have a version of an exported package and we need to calculate the range for that. The rules come from the consumer or provider policy. However, this policy can be overridden on the Import-Package header by specifying the version as a range macro:" />
<meta property="og:description" content="The range macro takes a version range mask/template and uses it calculate a range from a given version. The primary reason for the ${range} macro is to be used in the version policy. With the version policy we have a version of an exported package and we need to calculate the range for that. The rules come from the consumer or provider policy. However, this policy can be overridden on the Import-Package header by specifying the version as a range macro:" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-10-12T19:48:23-04:00" />
<script type="application/ld+json">
{"headline":"range ‘;’ RANGE_MASK ( ‘;’ VERSION )","dateModified":"2019-10-12T19:48:23-04:00","datePublished":"2019-10-12T19:48:23-04:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"/releases/4.2.0/macros/range.html"},"url":"/releases/4.2.0/macros/range.html","description":"The range macro takes a version range mask/template and uses it calculate a range from a given version. The primary reason for the ${range} macro is to be used in the version policy. With the version policy we have a version of an exported package and we need to calculate the range for that. The rules come from the consumer or provider policy. However, this policy can be overridden on the Import-Package header by specifying the version as a range macro:","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->




































































</head>


<body>


<ul class="container12 menu-bar">
	<li span=11><a class=menu-link href="/releases/4.2.0/"><img
			class=menu-logo src='/releases/4.2.0/img/bnd-80x40-white.png'></a>
			<a href="/releases/4.2.0/chapters/110-introduction.html">Intro
			</a><a href="/releases/4.2.0/chapters/800-headers.html">Headers
			</a><a href="/releases/4.2.0/chapters/825-instructions-ref.html">Instructions
			</a><a href="/releases/4.2.0/chapters/855-macros-ref.html">Macros
			</a><a href="/releases/4.2.0/chapters/400-commands.html">Commands
			</a><div class="releases"><button class="dropbtn">4.2.0</button><div class="dropdown-content"></div></div>

	<li class=menu-link span=1>
			<a href="https://github.com/bndtools/bnd" target="_"><img
	style="position:absolute;top:0;right:0;margin:0;padding:0;z-index:100"
	src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67"
	alt="Fork me on GitHub"
	data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
</ul>




	<ul class=container12>
		<li span=3>
			<div>
			<ul class="side-nav">


			<li><a href="/releases/4.2.0/chapters/110-introduction.html">Introduction</a>



			<li><a href="/releases/4.2.0/chapters/120-install.html">How to install bnd</a>



			<li><a href="/releases/4.2.0/chapters/123-tour-workspace.html">Guided Tour</a>



			<li><a href="/releases/4.2.0/chapters/125-tour-features.html">Guided Tour Workspace & Projects</a>



			<li><a href="/releases/4.2.0/chapters/130-concepts.html">Concepts</a>



			<li><a href="/releases/4.2.0/chapters/140-best-practices.html">Best practices</a>



			<li><a href="/releases/4.2.0/chapters/150-build.html">Build</a>



			<li><a href="/releases/4.2.0/chapters/160-jars.html">Generating JARs</a>



			<li><a href="/releases/4.2.0/chapters/170-versioning.html">Versioning</a>



			<li><a href="/releases/4.2.0/chapters/180-baselining.html">Baselining</a>



			<li><a href="/releases/4.2.0/chapters/200-components.html">Service Components</a>



			<li><a href="/releases/4.2.0/chapters/210-metatype.html">Metatype</a>



			<li><a href="/releases/4.2.0/chapters/220-contracts.html">Contracts</a>



			<li><a href="/releases/4.2.0/chapters/230-manifest-annotations.html">Manifest Annotations</a>



			<li><a href="/releases/4.2.0/chapters/250-resolving.html">Resolving Dependencies</a>



			<li><a href="/releases/4.2.0/chapters/300-launching.html">Launching</a>



			<li><a href="/releases/4.2.0/chapters/305-Junit-Testing-OSGi.html">Plain JUnit Testing with OSGi (PRELIMENARY)</a>



			<li><a href="/releases/4.2.0/chapters/310-testing.html">Testing</a>



			<li><a href="/releases/4.2.0/chapters/320-packaging.html">Packaging Applications</a>



			<li><a href="/releases/4.2.0/chapters/390-wrapping.html">Wrapping Libraries to OSGi Bundles</a>



			<li><a href="/releases/4.2.0/chapters/400-commands.html">Commands</a>



			<li><a href="/releases/4.2.0/chapters/600-developer.html">For Developers</a>



			<li><a href="/releases/4.2.0/chapters/700-tools.html">Tools bound to bnd</a>



			<li><a href="/releases/4.2.0/chapters/800-headers.html">Headers</a>



			<li><a href="/releases/4.2.0/chapters/820-instructions.html">Instruction Reference</a>



			<li><a href="/releases/4.2.0/chapters/825-instructions-ref.html">Instruction Index</a>



			<li><a href="/releases/4.2.0/chapters/850-macros.html">Macro Reference</a>



			<li><a href="/releases/4.2.0/chapters/855-macros-ref.html">Macro Index</a>



			<li><a href="/releases/4.2.0/chapters/870-plugins.html">Plugins</a>



			<li><a href="/releases/4.2.0/chapters/880-settings.html">Settings</a>



			<li><a href="/releases/4.2.0/chapters/900-errors.html">Errors</a>



			<li><a href="/releases/4.2.0/chapters/910-warnings.html">Warnings</a>



			<li><a href="/releases/4.2.0/chapters/920-faq.html">Frequently Asked Questions</a>


</ul>

			</div>

		<li span=9>
			<div class=notes-margin>
				<h1> range ';' RANGE_MASK ( ';' VERSION )</h1>
				<p>The <code class="highlighter-rouge">range</code> macro takes a version range mask/template and uses it calculate a range from a given version. The primary reason for the <code class="highlighter-rouge">${range}</code> macro is to be used in the <a href="/chapters/170-versioning.html">version policy</a>. With the version policy we have a version of an exported package and we need to calculate the range for that. The rules come from the <a href="/instructions/consumer_policy.html">consumer</a> or <a href="/instructions/provider_policy.html">provider</a> policy. However, this policy can be overridden on the Import-Package header by specifying the version as a range macro:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Import-Package: com.example.myownpolicy; version="${range;[==,=+)}", *
</code></pre></div></div>
<p>&lt;foo ]&gt;</p>

<p>Since the version for the exported package is set as <code class="highlighter-rouge">${@}</code>, the macro will calculate the proper semantic range for a provider.</p>

<p>The syntax for the <code class="highlighter-rouge">range</code> macro is:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>range ::= ( '\[' |'\( ) mask ',' mask ( '\)' | '\]' )
mask  ::= m ( m ( m )? )? q
m     ::= [0-9=+-~]
q     ::= [0-9=~Ss]
</code></pre></div></div>

<p>The meaning of the characters is:</p>

<ul>
  <li><code class="highlighter-rouge">=</code> – Keep the version part</li>
  <li><code class="highlighter-rouge">-</code> – Decrement the version part</li>
  <li><code class="highlighter-rouge">+</code> – Increment the version part</li>
  <li><code class="highlighter-rouge">[0-9]</code> – Replace the version part</li>
  <li><code class="highlighter-rouge">~</code> – Ignore the version part</li>
  <li><code class="highlighter-rouge">[Ss]</code> – If the qualifier equals <code class="highlighter-rouge">SNAPSHOT</code>, then it will return a maven like snapshot version. Maven snapshot versions do not use the <code class="highlighter-rouge">.</code> as the separator but a <code class="highlighter-rouge">-</code> sign. The upper case <code class="highlighter-rouge">S</code> checks case sensitive, the lower case <code class="highlighter-rouge">s</code> is case insensitive. This template character will be treated as the last character in the template and return the version immediately. For example, <code class="highlighter-rouge">${versionmask;=S;1.2.3.SNAPSHOT}</code> will return <code class="highlighter-rouge">1-SNAPSHOT</code>.</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/**
 * Schortcut for version policy
 *
 * &lt;pre&gt;
 * -provide-policy : ${policy;[==,=+)}
 * -consume-policy : ${policy;[==,+)}
 * &lt;/pre&gt;
 *
 * @param args
 * @return
 */

static Pattern	RANGE_MASK		= Pattern.compile("(\\[|\\()(" + MASK_STRING + "),(" + MASK_STRING + ")(\\]|\\))");
static String	_rangeHelp		= "${range;&lt;mask&gt;[;&lt;version&gt;]}, range for version, if version not specified lookup ${@}\n"
										+ "&lt;mask&gt; ::= [ M [ M [ M [ MQ ]]]\n"
										+ "M ::= '+' | '-' | MQ\n"
										+ "MQ ::= '~' | '='";
static Pattern	_rangePattern[]	= new Pattern[] {
		null, RANGE_MASK
								};

public String _range(String args[]) {
	verifyCommand(args, _rangeHelp, _rangePattern, 2, 3);
	Version version = null;
	if (args.length &gt;= 3)
		version = new Version(args[2]);
	else {
		String v = domain.getProperty("@");
		if (v == null)
			return null;
		version = new Version(v);
	}
	String spec = args[1];

	Matcher m = RANGE_MASK.matcher(spec);
	m.matches();
	String floor = m.group(1);
	String floorMask = m.group(2);
	String ceilingMask = m.group(3);
	String ceiling = m.group(4);

	String left = version(version, floorMask);
	String right = version(version, ceilingMask);
	StringBuilder sb = new StringBuilder();
	sb.append(floor);
	sb.append(left);
	sb.append(",");
	sb.append(right);
	sb.append(ceiling);

	String s = sb.toString();
	VersionRange vr = new VersionRange(s);
	if (!(vr.includes(vr.getHigh()) || vr.includes(vr.getLow()))) {
		domain.error("${range} macro created an invalid range %s from %s and mask %s", s, version, spec);
	}
	return sb.toString();
}
</code></pre></div></div>


			</div>
	</ul>


<nav class=next-prev>
	<a href='/releases/4.2.0/macros/random.html'></a> <a href='/releases/4.2.0/macros/reject.html'></a>
</nav>
<footer class="container12" style="border-top: 1px solid black;padding:10px 0">
	<ul span=12 row>
		<li span=12>
			<ul>
				<li><a href="/releases/4.2.0/">GitHub</a>
			</ul>
	</ul>
</footer>

</body>
</html>
