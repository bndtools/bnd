<!DOCTYPE html>
<html lang="en" ng-app="jpm">

	<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="/releases/7.2.0/css/style.css" rel="stylesheet" />
<link rel="stylesheet" href="/css/github.dark.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="sitemap" type="application/xml" title="bnd Sitemap" href="/sitemap.xml">
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="/js/releases.js"></script>

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Resolving Dependencies | bnd</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Resolving Dependencies" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="OSGi’s Best Kept Secret" />
<meta property="og:description" content="OSGi’s Best Kept Secret" />
<meta property="og:site_name" content="bnd" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-12-27T00:11:56+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Resolving Dependencies" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-12-27T00:11:56+01:00","datePublished":"2025-12-27T00:11:56+01:00","description":"OSGi’s Best Kept Secret","headline":"Resolving Dependencies","mainEntityOfPage":{"@type":"WebPage","@id":"/releases/7.2.0/chapters/250-resolving.html"},"url":"/releases/7.2.0/chapters/250-resolving.html"}</script>
<!-- End Jekyll SEO tag -->


	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	
		<style>
			 body {
				counter-reset: h1 19;
			}
		</style>
	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

</head>


<body>
	
<ul class="container12 menu-bar" style="display:flex;align-items:center">
	<li span=8><a class=menu-link href="/releases/7.2.0/"><img
			class=menu-logo src="/releases/7.2.0/img/bnd-80x40-white.png"></a>
			<a 
				class="" 
				href="/releases/7.2.0/chapters/110-introduction.html">Intro
			</a>
			<a 
				class=""
				href="/releases/7.2.0/chapters/800-headers.html">Headers
			</a>
			<a 
				class=""
				href="/releases/7.2.0/chapters/825-instructions-ref.html">Instructions
			</a>
			<a 
				class=""
				href="/releases/7.2.0/chapters/855-macros-ref.html">Macros
			</a>
			<a 
				class=""
				href="/releases/7.2.0/chapters/400-commands.html">Commands
			</a>
			<div class="releases">
				<button class="dropbtn"><span class="fa fa-bars"></span> 7.2.0</button>
				<div class="dropdown-content"></div>
			</div>
    <li span=4>     
        <div class="search-container">
			<button type="button" class="fa fa-search" onclick="openModal()"></button>
       </div>
</ul>
<div class=menu-link span=0><a
	id="repo-link"
	href="https://github.com/bndtools/bnd/blob/master/docs/_chapters/250-resolving.md"
	target="_blank"
>
	<img
		style="
			position: absolute;
			top: 0;
			right: 0;
			margin: 0;
			padding: 4px;
			z-index: 100;
			width: 45px;
		"
		src="/img/github-mark.svg"
		alt="Fork me on GitHub"
		title="Fork me on GitHub"
/></a>
</div>



					

	<ul class=container12>
		<li span=3>
			<div class="side-nav">
			
	
	<ul class="side-nav">
	<li><span class="side-nav-section">Getting Started</span>
		<ul class="side-nav">
		
			
				

					
					<li><a href="/releases/7.2.0/chapters/110-introduction.html">Introduction</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/120-install.html">How to install bnd</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/123-tour-workspace.html">Guided Tour Workspace & Projects</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/125-tour-features.html">bnd / bndlib Features and JAR Wrapping Techniques</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/920-faq.html">FAQ - Frequently Asked Questions</a></li>
					

				
				
			
			
		
		</ul>
	</li>
	</ul>

	
	<ul class="side-nav">
	<li><span class="side-nav-section">Concepts and Practices</span>
		<ul class="side-nav">
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/130-concepts.html">Concepts</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/135-history.html">Background</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/140-best-practices.html">Best practices</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
		</ul>
	</li>
	</ul>

	
	<ul class="side-nav">
	<li><span class="side-nav-section">Build and Development</span>
		<ul class="side-nav">
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/150-build.html">Build</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/160-jars.html">Generating JARs</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/170-versioning.html">Versioning</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/180-baselining.html">Baselining</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/200-components.html">Service Components</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/210-metatype.html">Metatype</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/220-contracts.html">Contracts</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/230-manifest-annotations.html">Bundle Annotations</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/235-accessor-properties.html">Accessor Properties</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/240-spi-annotations.html">SPI Annotations</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
		</ul>
	</li>
	</ul>

	
	<ul class="side-nav">
	<li><span class="side-nav-section">Dependency and Launching</span>
		<ul class="side-nav">
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li class=selected>Resolving Dependencies</li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/300-launching.html">Launching</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/305-startlevels.html">Startlevels</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
		</ul>
	</li>
	</ul>

	
	<ul class="side-nav">
	<li><span class="side-nav-section">Testing</span>
		<ul class="side-nav">
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/310-testing.html">Testing</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/315-launchpad-testing.html">Testing with Launchpad</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
		</ul>
	</li>
	</ul>

	
	<ul class="side-nav">
	<li><span class="side-nav-section">Packaging and Distribution</span>
		<ul class="side-nav">
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/320-packaging.html">Packaging Applications</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/330-jpms.html">JPMS Libraries</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/390-wrapping.html">Wrapping Libraries to OSGi Bundles</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
		</ul>
	</li>
	</ul>

	
	<ul class="side-nav">
	<li><span class="side-nav-section">Documentation and Tools</span>
		<ul class="side-nav">
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/395-generating-documentation.html">Generating Documentation</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/400-commands.html">bnd CLI Commands</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/600-developer.html">For Developers</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/620-template-fragments.html">Templates for Workspaces</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/650-windows.html">Tips for Windows users</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/700-tools.html">Tools bound to bnd</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
		</ul>
	</li>
	</ul>

	
	<ul class="side-nav">
	<li><span class="side-nav-section">Reference Material</span>
		<ul class="side-nav">
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/790-reference.html">Reference</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/800-headers.html">Headers</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/820-instructions.html">Instruction Reference</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/825-instructions-ref.html">Instruction Index</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/850-macros.html">Macro Reference</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/855-macros-ref.html">Macro Index</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/870-plugins.html">Plugins</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/875-external-plugins.html">External Plugins</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
			
		
		</ul>
	</li>
	</ul>

	
	<ul class="side-nav">
	<li><span class="side-nav-section">Configuration and Troubleshooting</span>
		<ul class="side-nav">
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/880-settings.html">Settings</a></li>
					

				
				
			
				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/900-errors.html">Errors</a></li>
					

				
				
			
				
				
			
				
				
			
			
		
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				
				
			
				

					
					<li><a href="/releases/7.2.0/chapters/910-warnings.html">Warnings</a></li>
					

				
				
			
				
				
			
			
		
		</ul>
	</li>
	</ul>




			</div>
			
		<li span=9>
			<div class=notes-margin>

<main data-pagefind-body>
				<div class="page-header">
					<h1 data-pagefind-filter="pagetype:chapters"> Resolving Dependencies</h1>
					<div class="container-right">
						<nav class="next-prev" data-pagefind-ignore>
     
    <a href='/releases/7.2.0/chapters/240-spi-annotations.html' title="SPI Annotations">Prev</a> 
     
    
    <a href='/releases/7.2.0/chapters/300-launching.html' title="Launching">Next</a>
     
</nav>
						
						
						
					</div>
					
				</div>

				<h2 id="osgis-best-kept-secret">OSGi’s Best Kept Secret</h2>

<p>This Application Note is about <em>resolving</em> in OSGi. The OSGi Framework has always used a <em>resolver</em> to <em>wire</em> a given set of bundles together, ensuring that only valid wires are made. However, the same OSGi resolver can also be used to select a set of bundles from a much larger set. This application note discusses this secondary usage.</p>

<p>The resolver model is based on technology developed in OSGi since 2006 with <a href="https://github.com/osgi/design/raw/main/rfcs/rfc0112/rfc-0112-OBR.pdf">RFC-0112 Bundle Repository</a>. This RFC laid out a model that was gradually implemented in the OSGi specifications and for which many tools were developed. Resolving automates a task that is mostly done manually today.</p>

<h2 id="what-problem-is-being-resolved">What Problem is Being (Re)Solved?</h2>

<p>The pain that the resolver solves is well known to anybody that builds application from modules, the so called <em>assembly</em> process. All developers know the dreadful feeling of having to drag in more and more dependencies to get rid of Class Not Found errors when the application starts (or after running for an hour). For many, Maven was a significant improvement because it made this process so much easier because dependencies in Maven are <em>transitive</em>. If you depend on some artefact, then this artefact drags in its own dependencies to the runtime.</p>

<p>Unfortunately, the Maven dependency model has limitations for a number of reasons. Though it undeniably has become easier to get <em>a</em> result, the result is often littered with unnecessary or wrong artefacts. Often application developers have no real understanding what is in their runtime.</p>

<p>These are the causes:</p>

<ul>
  <li><strong>Our small minds</strong> – The human mind and human motivation provide little support for properly maintaining any amount of meta-data. Many open source projects show unnecessary dependencies that were once needed but no longer necessary. Fortunately, Maven Central/Sonatype has become much more restrictive. However, in the past, a lot of Maven dependencies were quite bad.</li>
  <li><strong>Aggregate problem</strong> – The aggregate problem stems from a dependency that is used for one small part but where a co-packaged part drags in other (and therefore unnecessary) dependencies. For example, many JARs provide support for Ant, a former build tool. This was useful if you happened to use Ant but it caused the addition of the Ant runtime in systems that never used Ant. The aggregate problem causes a serious increase of dependency fan-out in many projects.</li>
  <li><strong>Version Conflicts</strong> – When you drag in a lot of dependencies you invariably run into a situation where two of your dependencies require the same third dependency but in different versions. (This is called the <em>diamond</em> problem for obvious reasons if you draw the graph.) Sometimes these versions are really incompatible, sometimes the higher would suffice. However, in Maven, the first artefact encountered in a breadth first search defines the version.</li>
  <li><strong>Variations</strong> – In many situations it is necessary to create different variations of an application. For example, an application could be delivered for different platforms or in a demo variation and a full monty variation. Since the Maven transitive dependency model creates a fixed graph it is not suitable to assemble these variations easily. That is, there often is not a single runtime.</li>
</ul>

<p>The result is that all too often the class path of the final application is littered with never used byte codes and/or overlapping packages that came from artefacts with different versions. If the customer could see the mess the average class path is they would run away screaming.</p>

<p>Establishing the perfect class path for an application is a process for which the human mind is extremely badly suited and the transitive model of Maven has too many sharp edges. The resolver provides an alternative model that focuses on looking at the whole solution space instead of having to live with the (sometimes arbitrary) decisions of developers or of deeply nested transitive dependencies.</p>

<h2 id="principles">Principles</h2>

<p><img src="https://user-images.githubusercontent.com/200494/31130842-cf5299d2-a858-11e7-907c-d6cb43954501.png" alt="image" /></p>

<p>The design of the resolving model is quite simple. It consists of the following entities:</p>

<ul>
  <li><strong>Resource</strong> – A resource is a <em>description</em> of an artefact that can be <em>installed</em> in a system. When it is installed, it adds functions to that system. However, before it can be installed it requires certain functions to already be present. A resource can describe a bundle but it could also describe a piece of hardware or a certificate. It is important to realise that a resource is <em>not</em> the artefact, it is a description of the <em>relation</em> between the artefact and the target system. For example, in OSGi the bundle is a JAR file that can be installed in a framework, this is the artefact. A resource describes formally what that bundle can contribute to the system and what it needs from the system.</li>
  <li><strong>Capability</strong> – A capability is a description of a resource’s contribution to the system when its artefact is installed. A capability has a <em>type</em> and a set of <em>properties</em>. That is, it is a bit like a DTO (or <em>struct</em>). The type is defined by name and is therefore called the <em>namespace</em>. The properties are key value pairs, where the keys are strings and values can be scalars or collections of <code class="language-shell highlighter-rouge">String</code>, <code class="language-shell highlighter-rouge">Integer</code>, <code class="language-shell highlighter-rouge">Double</code>, and <code class="language-shell highlighter-rouge">Long</code>.</li>
  <li><strong>Requirement</strong> – A requirement represents the <em>needs</em> of an artefact when it is installed in the system. Since we describe the system with capabilities, we need a way to assert the properties of a capability in a given namespace. A requirement therefore consists of a type and an <em>OSGi filter</em>. The type is the same as for the capabilities, it is the namespace. The filter is constructed from a powerful filter language based on LDAP. A filter can assert expressions of arbitrary complexity. A requirement can be <em>mandatory</em> or <em>optional</em>.</li>
  <li><strong>Namespace</strong> – Since a requirement can match any set of properties it is necessary to scope the capabilities it can be asserted against. This is achieved by giving a requirement and a capability a namespace. A requirement can only match a capability when the capability has the same namespace.</li>
</ul>

<p>Resolving in this App note is therefore the process of constructing an application out of <em>resources</em>. Resolving takes a list of <em>initial requirements</em>, a description of the <em>system capabilities</em>, and one or more <em>repositories</em>. It will use the list of initial requirements to find resources in the repository that provide the required capabilities. Clearly, these resources have their own requirements, retrieving applicable resources is therefore a recursive process. A <em>resolver</em> will find either a solution consisting of a set of resources where all requirements are satisfied or that there is no solution.</p>

<p>It is important to realise that a resource and its capabilities and requirements are descriptions. They provide a formal representation of an external artefact. Since these formal representations can be read by a computer, we can calculate a closure of resources that, when installed together, have only resources where all their mandatory requirements are <em>satisfied</em> by the resources in the closure.</p>

<h3 id="core-namespaces">Core Namespaces</h3>

<p>Although the OSGi specifications started out with a set of headers that each had their own semantics, over time the specification migrated fully to the more simple and formal model of Resources, Capabilities, and Requirements. Since the function of the legacy headers were still needed, it was necessary to map these legacy headers to the formal model. This resulted in a number of OSGi core namespaces.</p>

<ul>
  <li><code class="language-shell highlighter-rouge">osgi.wiring.identity</code> – <code class="language-shell highlighter-rouge">Bundle-SymbolicName</code> header.</li>
  <li><code class="language-shell highlighter-rouge">osgi.wiring.bundle</code> – <code class="language-shell highlighter-rouge">Bundle-SymbolicName</code> and <code class="language-shell highlighter-rouge">Require-Bundle</code> header.</li>
  <li><code class="language-shell highlighter-rouge">osgi.wiring.package</code> – <code class="language-shell highlighter-rouge">Import-Package</code> and <code class="language-shell highlighter-rouge">Export-Package</code> headers.</li>
  <li><code class="language-shell highlighter-rouge">osgi.wiring.host</code> – <code class="language-shell highlighter-rouge">Bundle-SymbolicName</code> and <code class="language-shell highlighter-rouge">Fragment-Host</code> header.</li>
  <li><code class="language-shell highlighter-rouge">osgi.ee</code> – <code class="language-shell highlighter-rouge">Bundle-RequiredExecutionEnvironment</code> header.</li>
  <li><code class="language-shell highlighter-rouge">osgi.native</code> – <code class="language-shell highlighter-rouge">Bundle-NativeCode</code> header.</li>
  <li><code class="language-shell highlighter-rouge">osgi.content</code> – Provides the URL and checksum to download the corresponding artefact. (This namespace is defined in the compendium Repository specification.)</li>
</ul>

<p>Each namespace defines the names of the properties and their semantics. For the OSGi namespaces, there are classes like <code class="language-shell highlighter-rouge">org.osgi.framework.namespace.IdentityNamespace</code> that contain the details of a namespace.</p>

<h3 id="example-resource-model">Example Resource Model</h3>

<p>To make the model more clear let’s take a closer look to a simple bundle <code class="language-shell highlighter-rouge">com.example.bundle</code> that exports package <code class="language-shell highlighter-rouge">com.example.pe</code> and imports a package <code class="language-shell highlighter-rouge">com.example.pi</code>. When the bundle is installed it will require that some other bundle, or the framework, provides package <code class="language-shell highlighter-rouge">com.example.pi</code>. We can describe this bundle then as follows:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Resource <span class="k">for </span>bundle com.example.bundle
   capabilities:
     osgi.wiring.identity<span class="p">;</span>  osgi.wiring.identity<span class="o">=</span>com.example.bundle
     osgi.wiring.bundle<span class="p">;</span>    osgi.wiring.bundle<span class="o">=</span>com.example.bundle
     osgi.wiring.host<span class="p">;</span>      osgi.wiring.host<span class="o">=</span>com.example.bundle
     osgi.wiring.package<span class="p">;</span>   osgi.wiring.package<span class="o">=</span>com.example.pe
   requirements:
     osgi.ee<span class="p">;</span>               filter:<span class="o">=</span><span class="s2">"(&amp;(osgi.ee=JavaSE)(version=1.8))"</span>
     osgi.wiring.package<span class="p">;</span>   filter:<span class="o">=</span><span class="s1">'(osgi.wiring.package=com.example.pi)'</span>
</code></pre></div></div>

<h2 id="who-wants-to-provide-that-gibberish">Who Wants to Provide That Gibberish???</h2>

<p>Clearly, an <code class="language-shell highlighter-rouge">Export-Package: com.example.pe</code> is a bit easier to read than the corresponding capability, let alone the filter in the requirement. This is especially true when the versions are taken into account, with the assertion of the version range the filters become quite unreadable. Clearly, if this had to be maintained by human developers then a model like Maven would be far superior. Fortunately, almost all of the metadata that is needed to make this work does not require much extra work from the developer. For example, the <code class="language-shell highlighter-rouge">bnd</code> tool that is available in Maven, Gradle, Eclipse, Intellij and others can easily analyse a JAR file and automatically generate the requirements and capabilities based on the source code.</p>

<p>In certain cases it is necessary to provide requirements and capabilities that bnd cannot infer. However, <a href="230-manifest-annotations.html">Manifest annotations</a> support in bnd can be used to define an annotation that will add parameterised requirements to the resource.</p>

<p>Really, when you use an adequately appointed toolchain (like Bndtools) none of this gibberish is visible to normal developers unless they have a special case. The gibberish is left to the tools that prefer gibberish over natural language.</p>

<h2 id="how-to-write-resolvable-bundles">How to Write Resolvable Bundles</h2>

<p>For a bundle to be a good citizen in a resolution it suffices to follow the standard rules of good software engineering. However, since there is so much software out there that does not follow these rules, a short summary.</p>

<ul>
  <li><strong>Minimise Dependencies</strong> – Every dependency has a cost. Always consider if all dependencies are <em>really</em> necessary. Although a dependency can provide a short term gain for the coder, it will have consequences for the later stages in the development process. Perfect bundles are bundles that have no dependencies. Unfortunately they are also often useless (although you can still build a lot from Java SE <code class="language-shell highlighter-rouge">java.<span class="k">*</span></code> which is an implicit import). Therefore, a developer must always be aware of this trade off.</li>
  <li><strong>API Driven</strong> – Always, always, always separate API and implementation. A lot of developers avoid the overhead of developing an API when they consider the (initial) problem too simple to do the effort of a separate API. The author of this App note is one of them but he never, ever did not regret this. Usually he then spent a lot of extra effort to add an API afterwards.</li>
  <li><strong>Service Oriented</strong> – The best dependencies are service oriented dependencies. Services make the coupling between modules explicit and allow different implementations to provide the same service. For example, use a simple DTOs service that handles type conversions and JSON parsing/generating. In projects where I see the explicit use of Jackson it always seems to cause a mess of required JARs visible in each bundle project.</li>
  <li><strong>Package Imports</strong> – A bundle can require other bundles (the Maven model) or it can import packages from other bundles. The best imported packages are the ones used for services since they are <em>specification only</em>. Second best are <em>libraries</em>. Library packages have no internal state nor use statics. Importing implementation packages for convenience is usually deemed bad practice because it often indicates that the decomposition in bundles is not optimal.</li>
  <li><strong>Import the Exports</strong> – If a package is exported <strong>and</strong> used inside the same bundle then the exported package should also be imported. This allows the resolver more leeway.</li>
</ul>

<p>To see the requirements and capabilities of a bundle Bndtools has a special <code class="language-shell highlighter-rouge">Resolution</code> view. This shows the requirements and capabilities of a selected JAR file or a bnd.bnd file.</p>

<p><img src="https://user-images.githubusercontent.com/200494/31276722-9cf2df0a-aa9d-11e7-9f9a-6dd58fc16972.png" width="50%" /></p>

<p>This view uses a number of icons to represent the requirements/capabilities. You can hover over them to see further details.</p>

<ul>
  <li><img src="https://user-images.githubusercontent.com/200494/31222248-c962b09c-a9c6-11e7-99ac-1977a6c736fd.png" alt="service" /> – <code class="language-shell highlighter-rouge">osgi.service</code>.</li>
  <li><img src="https://user-images.githubusercontent.com/200494/31222315-f8e60454-a9c6-11e7-82d8-bbaa7acc46b1.png" alt="bullet_green" /> – <code class="language-shell highlighter-rouge">osgi.identity</code></li>
  <li><img src="https://user-images.githubusercontent.com/200494/31222346-1153abf4-a9c7-11e7-97df-1bfa7a967505.gif" alt="package" /> – <code class="language-shell highlighter-rouge">osgi.wiring.package</code></li>
  <li><img src="https://user-images.githubusercontent.com/200494/31222445-6a2231ce-a9c7-11e7-8242-c226709f9a76.png" alt="java" /> – <code class="language-shell highlighter-rouge">osgi.ee</code></li>
  <li><img src="https://user-images.githubusercontent.com/200494/31222450-7156a204-a9c7-11e7-800e-9c67837f4cef.png" alt="wand" /> – <code class="language-shell highlighter-rouge">osgi.extender</code></li>
  <li><img src="https://user-images.githubusercontent.com/200494/31222500-9460eade-a9c7-11e7-9a75-50ae25a35c00.png" alt="bundle" /> – <code class="language-shell highlighter-rouge">osgi.bundle</code></li>
</ul>

<p>Developers that are keen on developing good bundles should pay close attention to this pane.</p>

<h2 id="resolving">Resolving</h2>

<p><img src="https://user-images.githubusercontent.com/200494/31221580-73596198-a9c4-11e7-8d11-1e1fe7e37199.png" alt="Resolving" /></p>

<p>The previous diagram adds the resolver to the earlier diagram of the basic model. It adds the following entities:</p>

<ul>
  <li><strong>Repository</strong> – A Repository is a collection of resources. Repositories can be represented in many different ways as will be discussed later.</li>
  <li><strong>Resolver</strong> – The Resolver is the entity that takes a set of <em>initial requirements</em>, <em>system capabilities</em>, a set of repositories, and produces a <em>resolution</em>.</li>
  <li><strong>Resolution</strong> – A resolution is a <em>wiring</em> of resources. It provides detailed information about what requirements are matched with what capabilities from the included resources.</li>
</ul>

<p>An important variable in the resolving process is <code class="language-shell highlighter-rouge">effective</code> which defines the <em>effectiveness</em> under which the resolve operation is performed. The resolver will only look at requirements that it deems <em>effective</em>. The default effectiveness is <code class="language-shell highlighter-rouge">resolve</code>. The effectiveness <code class="language-shell highlighter-rouge">active</code> is a convention commonly used for situations that do not need to be resolved by the OSGi framework but are relevant in using the resolver for assembling applications.</p>

<h2 id="repositories">Repositories</h2>

<p>A <em>repository</em> is a collection of resources. This could be Maven Central or it could be a single bundle. That said, neither is a good idea in practice. The repository is the <em>scope</em> of the resolution. Only resources in the repository can be selected. Although the naive idea is to make the scope as large as possible to let the computer do the work, it is much better to <em>curate</em> the repository.</p>

<p>There are many reasons why you need a curated repository but basically it comes down is the GIGO principle: garbage is garbage out. Another reason is running time. The resolver gets overwhelmed quickly when there are too many alternatives for a requirement. Resolving is an NP complete problem and this means that the resolution time quickly becomes very long when a lot of alternatives need to be examined.</p>

<h3 id="available-repositories">Available Repositories</h3>

<p>The bnd toolchain provides OSGi Repository access for many popular repository formats.</p>

<ul>
  <li><strong>OSGi XML Format</strong> – The OSGi Alliance specified an XML format for repositories which is fully supported by bnd.</li>
  <li><strong>Maven Central</strong> – You can provide subsets of Maven repositories using a simple text file, a query on Maven Central, or a <code class="language-shell highlighter-rouge">pom.xml</code>. It integrates fully with the local <code class="language-shell highlighter-rouge">~/.m2</code> repository.</li>
  <li><strong>Eclipse P2</strong> – Eclipse repositories have a web based layout that can be parsed by bnd.</li>
  <li><strong>File based</strong> – You can store bundles in a directory structure and use it as a repository.</li>
  <li><strong>Eclipse Workspace</strong> – In Bndtools, all generated bundles in a workspace are directly available to the resolver.</li>
</ul>

<p>Since bnd has an extensive library to parse bundles and generate the resources it is relatively easy to parse bundles in other ways. For example, there is a Maven plugin that can generate an OSGi index.</p>

<h3 id="managing-repositories">Managing Repositories</h3>

<p>A repository generally represents a <em>release</em> of a software product. Many developers publish an OSGi Repository XML to allow the resolver access to the metadata of their bundles, for example <a href="https://www.knopflerfish.org/releases/4.0.1/repository.xml">Knopflerfish</a> produces an OSGi XML Repository with all their bundles.</p>

<p>This model is in contrast with Maven Central and most other Maven repositories. These repositories are designed to contain everything that was ever released. An OSGi repository is more the content of a specific release. Since it generally only contains a specific release, it will disallow the resolver to use any unwanted resources.</p>

<h3 id="workspace-repository">Workspace Repository</h3>

<p>A natural repository is the bnd <em>workspace</em> since a workspace is a collection of <em>related</em> projects. Since these projects are build together it is trivial to keep them compatible. The metadata burden can be mitigated by sharing metadata between these related projects. For example, in bnd all bundles share the same version. Although this might sometimes release unchanged bundles under a newer version, the only cost is a bit of disk space. A small price to pay for an otherwise very error prone manual process. The Gradle build can release to a Nexus repository and automatically generate an index that can be used as repository.</p>

<h2 id="resolving-in-bndtools">Resolving in Bndtools</h2>

<p>By far the best way to get experience with the resolver is using the bnd’s <code class="language-shell highlighter-rouge">bndrun</code> files. Bndtools provides a friendly user interface that makes it easy to use the OSGi Resolver in an interactive way.</p>

<p>A <code class="language-shell highlighter-rouge">bndrun</code> describes the runtime configuration for an application. This can either be a standalone executable JAR or an application that should be hosted in a container like a Java EE server or Karaf. In this app note, the target is an executable JAR unless otherwise noted.</p>

<p>If you double click on the bndrun file, it opens a <em>Run</em> pane.</p>

<p><img alt="Run pane" src="https://user-images.githubusercontent.com/200494/31168440-9b5ff29e-a8f5-11e7-857f-22ec30202fd7.png" width="50%" />&gt;</p>

<p>Even though most lists are hidden, the pane is already quite overwhelming. So let’s go through the GUI and explain it one by one.</p>

<h3 id="core-runtime">Core Runtime</h3>

<p>Remember that a resolution is for a specific system, in our case an executable JAR. In the <code class="language-shell highlighter-rouge">Core Runtime</code> pane we specify the OSGi framework that will be used as well as the <em>execution environment</em>. The execution environment is from a list of Java VM versions and OSGi specifications.</p>

<p><img src="https://user-images.githubusercontent.com/200494/31168839-0ea01c56-a8f7-11e7-988f-faf2aea7e233.png" width="50%" /></p>

<p>The execution environment is used to calculate the <em>system capabilities</em>. That is, the system is treated as a single resource that provides the capabilities of the Framework as well as the capabilities of the OSGi defined execution environments. The system resource is always included in the resolution but can of course never be downloaded, it is the target environment.</p>

<h3 id="browse-repos">Browse Repos</h3>

<p>The <code class="language-shell highlighter-rouge">Browse Repos</code> is a list of the resources that are found in the active repositories. A search field makes it easy to find specific resources. For example, if you type in <code class="language-shell highlighter-rouge">gogo</code> it will list all Gogo bundles.</p>

<p><img src="https://user-images.githubusercontent.com/200494/31168644-59c03bc2-a8f6-11e7-800b-5abb32609f67.png" width="50%" /></p>

<p>One or more resources from the <code class="language-shell highlighter-rouge">Browse Repos</code> list can be selected and then dragged to the <code class="language-shell highlighter-rouge">Run Requirements</code> list to the left. This adds an <em>identity requirement</em> to the set of initial requirements. You can also drag a resource to the <code class="language-shell highlighter-rouge">Run Blacklist</code> and <code class="language-shell highlighter-rouge">Run Bundles</code> lists.</p>

<h3 id="run-requirements">Run Requirements</h3>

<p>This is the main list to watch. It contains the set of <em>initial requirements</em> given to the resolver. The GUI makes it possible to add identity requirements and remove listed requirements. The easiest way is to use drag and drop form the <code class="language-shell highlighter-rouge">Browse Repos</code> list but it is also possible to use the green <code class="language-shell highlighter-rouge">+</code>, which opens a dialog from which bundles can be added directly from the selected repositories.</p>

<p><img alt="Run Requirements" src="https://user-images.githubusercontent.com/200494/31171486-26d66416-a900-11e7-8856-0e4debb85e24.png" width="50%" /></p>

<h3 id="additional-components">Additional Components</h3>

<p>There are some more panes that are useful but they will be handled in diagnosing problems. For reference, a short introduction to these panes.</p>

<ul>
  <li><strong>Repositories</strong> – Allows the selection/unselection of some of the repositories. Can also switch the <code class="language-shell highlighter-rouge">bndrun</code> file to <em>standalone</em>. A standalone <code class="language-shell highlighter-rouge">bndrun</code> file has no relation to the workspace it resides in and establishes its own repositories.</li>
  <li><strong>Runtime Properties</strong> – Makes it possible to define OSGi framework properties, command line arguments, and VM arguments.</li>
  <li><strong>Run Blacklist</strong> – Any resources selected by the requirements in the blacklist can never be used in a resolution.</li>
  <li><strong>Run Bundles</strong> – This is normally the output of the resolver. However, it is possible to add/remove bundles from this list when the resolver is bypassed. The <code class="language-shell highlighter-rouge">Run</code>, <code class="language-shell highlighter-rouge">Debug</code>, and <code class="language-shell highlighter-rouge">Export</code> functions always work from the <code class="language-shell highlighter-rouge"><span class="nt">-runbundles</span></code> list.</li>
  <li><strong>Resolve</strong> – A popup that defines <em>when</em> the <a href="/instructions/resolve.html">resolver will run</a>.</li>
</ul>

<h2 id="resolving-1">Resolving</h2>

<p>Taking the initial requirement it is possible to resolve by clicking on the <code class="language-shell highlighter-rouge">Resolve</code> button. This will show a rather large dialog window with the resolution.</p>

<p><img alt="Resolution" src="https://user-images.githubusercontent.com/200494/31171747-285c920a-a901-11e7-978c-b6fb46c9c5aa.png" width="50%" /></p>

<p>This dialog window is divided in three main parts:</p>

<ul>
  <li><strong>Required Resources</strong> – The required resources are the solution that the resolver found based on the initial requirements and the system capabilities.</li>
  <li><strong>Optional Resources</strong> – During resolving some resources are included by an <em>optional</em> requirement. The resolver cannot automatically add optional resources, optional resources require human choice.</li>
  <li><strong>Reasons</strong> – Clicking on a required resource or an optional resource will show a <em>requirements trace</em> in this list. Sometimes a resource is added and it is not clear why it was added. Traversing through this list can then help finding out what caused its inclusion. If no solution was found, this list can also contain very useful information. This list is a great debugging tool.</li>
</ul>

<p>If some of the listed optional resources are desired then they can be selected. Pressing the <code class="language-shell highlighter-rouge">Update and Resolve</code> button will restart the resolver but now with the selected optional resources as mandatory.</p>

<p>If the <code class="language-shell highlighter-rouge">Finish</code> button is pressed then the current required resources list is converted to the list of <code class="language-shell highlighter-rouge">Run Bundles</code>. You can inspect them at the right bottom of the <code class="language-shell highlighter-rouge">bndrun</code> editor window.</p>

<p><img src="https://user-images.githubusercontent.com/200494/31172730-0528b2ba-a905-11e7-8e75-1ff36f9556b9.png" width="50%" /></p>

<p>After a successful resolve you can either <code class="language-shell highlighter-rouge">Run</code>, <code class="language-shell highlighter-rouge">Debug</code>, or <code class="language-shell highlighter-rouge">Export</code> the <code class="language-shell highlighter-rouge">bndrun</code> file.</p>

<h2 id="debugging-resolving">Debugging Resolving</h2>

<p>So far the ideal process of happy resolves and satisfied bundles has been described. It is now necessary to leave this rosy world and descend into the world of failed resolves. Unfortunately, the provided diagnostic information when a resolve fails is quite low.</p>

<p>When a resolve fails it returns a cause but more often than not this is not the real cause. This is not some shortcoming from the current resolver but a fundamental logical problem. The simplest form of a resolution is if you have for example 3 numbers 1,4,8. You need to find the numbers that sum to 10 using only addition and subtraction. If you try out all the combination then you find that no combination works. A failure report could be that -3 is not available because the last tried permutation was 1+4+8. Clearly, before that permutation many other numbers were missing as well, the missing -3 just happened to be the last one …</p>

<p>That said, there are a number of scenarios where the resolver does give a hint where the problem is.</p>

<h2 id="missing-requirement-false">Missing Requirement false</h2>

<p>This rather obscure message indicates that the resolver tries to include a <em>api</em> bundle that was made unresolvable.</p>

<p>The api bundle may have a special Require-Capability header such as:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Require-Capability: <span class="se">\</span>
  compile-only
</code></pre></div></div>

<p>This header creates a requirement that cannot be satisfied. There is nothing special with <code class="language-shell highlighter-rouge">compile-only</code>, it is just an unused namespace. It could also have been <code class="language-shell highlighter-rouge">foo-bar</code>.</p>

<p>In the resolver, you will see the following error chain:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Unable to resolve <span class="o">&lt;&lt;</span><span class="no">INITIAL</span><span class="sh">&gt;&gt; version=null:
    missing requirement osgi.enroute.examples.resolver.missingapi.provider
 -&gt;  Unable to resolve osgi.enroute.examples.resolver.missingapi.provider version=1.0.0.201710041250:
    missing requirement osgi.enroute.examples.resolver.missingapi.api; version=[1.0.0,1.1.0)
 -&gt;  Unable to resolve osgi.enroute.examples.resolver.missingapi.api version=1.0.0.201710041249:
    missing requirement false]]
</span></code></pre></div></div>

<p><strong>Note:</strong> Unfortunately, the output is blurred by a misguided attempt to make the output more concise. Because of this, the distinction between a bundle and a package is not very clear. Sadly you can only see the difference between a requirement for a bundle and a package by looking at the version. If this is a range then it is a package and if it is a version with a timestamp it is a bundle. (This works most of the time.) This is a bug in bnd and should be corrected.</p>

<p>As indicated, you really need to understand that the diagnostic is just the last path the resolver took. The <code class="language-shell highlighter-rouge">osgi.enroute.examples.resolver.missingapi.provider</code> bundle tries to find a provider for the package <code class="language-shell highlighter-rouge">osgi.enroute.examples.resolver.missingapi.api</code> and has found the <code class="language-shell highlighter-rouge">osgi.enroute.examples.resolver.missingapi.api</code> bundle. However, this API bundle has the impossible to satisfy <code class="language-shell highlighter-rouge">compile-only</code> requirement.</p>

<p>That said, it is better to look at the <code class="language-shell highlighter-rouge">Missing Requirements</code> list since this reports quite nicely what is missing.</p>

<p><img src="https://user-images.githubusercontent.com/200494/31177786-5aae5c3c-a917-11e7-98aa-112c380fb83b.png" width="50%" /></p>

<p>The icon and the text more clearly indicate that it cannot resolve the <code class="language-shell highlighter-rouge">osgi.enroute.examples.resolver.missingapi.api</code> bundle due to the <code class="language-shell highlighter-rouge">compile-only</code> requirement.</p>

<p>Exporting the API package from the provider bundle will correct this case.</p>

<h2 id="compendium-bundle">Compendium Bundle</h2>

<p>Many developers compile against the compendium bundle to get the OSGi service API packages.  Although compiling against an API bundle has advantages, using the compendium bundle in runtime is evil. Since the compendium bundle aggregates a large number of API packages it will have the tendency to unnecessarily constrain the versions of different APIs. That is, it blocks you from using newer APIs.</p>

<p>To make bundles that should not be used at runtime not resolvable there is the <code class="language-shell highlighter-rouge">Run Blacklist</code> list on the <code class="language-shell highlighter-rouge">bndrun</code> editor. This list contains bundles that should never be included in a resolution.</p>

<p>For example, we create a bundle that implements the Wire Admin service.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> public class MyService implements WireAdmin <span class="o">{</span>
      ...
 <span class="o">}</span>
</code></pre></div></div>

<p>This will cause a requirement for an exported package <code class="language-shell highlighter-rouge">org.osgi.service.wireadmin</code>.  We therefore add the OSGi compendium bundle to the <code class="language-shell highlighter-rouge"><span class="nt">-buildpath</span></code>. This then compiles fine.</p>

<p>However, the resolve will then drag in the OSGi compendium bundle.</p>

<p><img src="https://user-images.githubusercontent.com/200494/31179074-3153a0d2-a91b-11e7-972e-622c7db59dd5.png" alt="image" /></p>

<p>If we look at the reasons when we select the compendium bundle we see that also the Configuration Admin imports from the compendium even though it actually might provide a higher version. (This maybe understandable but a really bad practice.)</p>

<p><img src="https://user-images.githubusercontent.com/200494/31178847-8d5ca4d8-a91a-11e7-9df1-4a586bc191c1.png" width="50%" /></p>

<p>To get rid of the compendium bundle we can drag and drop it to the <code class="language-shell highlighter-rouge">Run Blacklist</code> window. Any requirement in the <code class="language-shell highlighter-rouge">Run Blacklist</code> list will automatically exclude all bundles that are selected by that requirement.</p>

<h2 id="you-are-sure-there-is-a-provider">You Are Sure There Is a Provider!</h2>

<p>Sometimes the resolver can complain about a missing requirement but you are sure that it is in the repository. The first thing is to try to isolate the problem. Almost any problem can be solved if you remove the redundant parts. Quite often developers are trying to debug this situation in a complex large <code class="language-shell highlighter-rouge">bndrun</code> file and then get overwhelmed.</p>

<p>Just create a new <code class="language-shell highlighter-rouge">bndrun</code> file and only add the bundle you think should provide the resource to the <code class="language-shell highlighter-rouge">Run Requires</code> list, keep only one requirement, and then resolve. If this resolves fine then at least you know that that bundle can potentially resolve.</p>

<p>However, often you find that even on its own it does not resolve. In most case the error message and the <code class="language-shell highlighter-rouge">Reasons</code> list provide sufficient information to understand why it does not resolve.</p>

<p>It is still a mystery, try checking the <code class="language-shell highlighter-rouge">Run Blacklist</code> list. If it is not there, it might be time to raise a bug.</p>

<h2 id="osgi-bnd-snapshot-viewer">OSGi bnd Snapshot Viewer</h2>

<p>Another tool for diagnosing potential issues in your OSGI framework (bundle, packages, services), the SCR info, configuration, log, and custom extensions is the <a href="/snapshot.html">OSGi bnd Snapshot Viewer</a>.</p>

<h2 id="the-source-view">The Source View</h2>

<p>So far this App Note only visited the <em>graphic user interface</em> (GUI). However, bnd always keeps all information in simple properties files that can also edited as text. In the Run editor (that edits <code class="language-shell highlighter-rouge">bndrun</code> files) you can also select the <code class="language-shell highlighter-rouge">Source</code> view. Not all features of a <code class="language-shell highlighter-rouge">bndrun</code> file can be manipulated through the GUI. This section therefore shows what is in the source and it can be manipulated.</p>

<p>Notice that most instructions are <a href="820-instructions.html"><em>merge properties</em></a>. That is, bnd will first find all properties that start with the instruction name and merge their values together. For example, if you set <code class="language-shell highlighter-rouge"><span class="nt">-runrequires</span></code>, <code class="language-shell highlighter-rouge"><span class="nt">-runrequires</span>.foo</code>, and <code class="language-shell highlighter-rouge"><span class="nt">-runrequires</span>.bar</code> bnd will use the combination of these properties. The order is the sorting order of the names used.</p>

<ul>
  <li><a href="/instructions/runfw.html">-runfw</a> – Defines the framework to use</li>
  <li><a href="/instructions/runbundles.html">-runbundles</a> – List of the bundles to run, calculated by the resolver.</li>
  <li><a href="/instructions/runsystemcapabilities.html">-runsystemcapabilities</a> – Additional capabilities provided by the framework.</li>
  <li><a href="/instructions/runsystempackages.html">-runsystempackages</a> – Additional packages exported by the framework.</li>
  <li><a href="/instructions/runrequires.html">-runrequires</a> – The initial requirements</li>
  <li><a href="/instructions/runprovidedcapabilities.html">-runprovidedcapabilities</a> – Only use with the <code class="language-shell highlighter-rouge"><span class="nt">-distro</span></code> option, it contains additional capabilities that are not in the distro files.</li>
  <li><a href="/instructions/runblacklist.html">-runblacklist</a> – Requirements that select resources that should never be part of the resolution.</li>
  <li><a href="/instructions/runee.html">-runee</a> – The execution environment</li>
  <li><a href="/instructions/runpath.html">-runpath</a> – The JARs that should be on the classpath. Exports and provided capabilities defined in the manifests of these JARs are added to the system capabilities.</li>
  <li><a href="/instructions/runrepos.html">-runrepos</a> – Optional list of ordered repo names. If this is not set, the current set of repo plugins is used.</li>
  <li><a href="/instructions/augment.html">-augment</a> – Adds virtual capabilities and requirements to resources in the repository.</li>
  <li><a href="/instructions/distro.html">-distro</a> – Directly provides the system capabilities in a JAR with Manifest. Is used when the resulotion is not used to create an executable JAR but to create a Java EE WAR or Karaf KAR where the application is running in a host environment.</li>
  <li><a href="/instructions/resolve.html">-resolve</a> – Controls when the resolver runs</li>
  <li><a href="/instructions/resolve.effective.html">-resolve.effective</a> – Sets the effectives for the resolver.</li>
  <li><a href="/instructions/resolve.preferences.html">-resolve.preferences</a> – Can be used to make some resources more equal than others.</li>
</ul>

<h2 id="augmenting-legacy-bundles">Augmenting Legacy Bundles</h2>

<p>The problem with metadata is that it can also be wrong. Especially legacy bundles lack the proper metadata to inform the resolver that they provide a service or require an implementation of a specification. This is not a problem in runtime since these requirements are generally not used by the Framework, they are designed for using the resolver in selecting a closure of bundles. However, in certain cases adding a capability or a requirement to a bundle in the repository would simplify things. Clearly it is possible to wrap the legacy bundle but this is extremely cumbersome and can create confusion down the line.</p>

<p>Therefore, another method is to use the <em>augments</em> that the bnd repositories support. Augments can add capabilities and requirements to existing bundles in a repository. However, it can only do this for the interactive resolve process. When the OSGi Framework resolves a number of bundles it will never takes augments into account.</p>

<p>There are two different ways to add the augments.</p>

<ul>
  <li><strong>Bndrun file</strong> – Provide the augments in the <code class="language-shell highlighter-rouge">bndrun</code> file. This is an ad-hoc mechanism that is normally a last resort. For non-standalone bndrun files you can also add augments in the <code class="language-shell highlighter-rouge">cnf/ext</code> directory since any bnd file in there will add its properties to the bndrun file. It is of course also possible to include file in any <code class="language-shell highlighter-rouge">bnd</code>/<code class="language-shell highlighter-rouge">bndrun</code> file.</li>
  <li><strong>Resource</strong> – Provide a resource in a repository that contains an <code class="language-shell highlighter-rouge">bnd.augment</code> capability. Such a resource has a file with properties that describe the augment for that repository. This is a good way when you have to curate a repository and need to fixup some legacy bundles. This resource can also add to the blacklist.</li>
</ul>

<p>In both cases the augments are described using the standard OSGi/bnd syntax. The syntax is not a beauty since it stretches what you can do with the OSGi header format. However, augmenting should really be a last resort so maybe it is not really bad that the syntax is cumbersome.</p>

<p>You can add an augment with the <code class="language-shell highlighter-rouge"><span class="nt">-augment</span></code> instruction in the <code class="language-shell highlighter-rouge">bndrun</code> file.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">-augment</span> PARAMETER <span class="o">(</span> <span class="s1">','</span> PARAMETER <span class="o">)</span> <span class="k">*</span>
</code></pre></div></div>

<p>Augmenting is adding additional capabilities and requirements. When bnd resolves a project or bndrun file, it will read these instructions. Since <code class="language-shell highlighter-rouge"><span class="nt">-augment</span></code> is a merge property you can also use additional keys like <code class="language-shell highlighter-rouge"><span class="nt">-augment</span>.xyz</code>.</p>

<p>The <code class="language-shell highlighter-rouge">key</code> of the <code class="language-shell highlighter-rouge">PARAMETER</code> is used for matching the Bundle Symbolic Name. It can contain the <code class="language-shell highlighter-rouge"><span class="k">*</span></code> wildcard character to match multiple bundles. The bundle symbolic name must be allowed as a value in a filter it is therefore not a globbing expression.</p>

<p>The following directives and attribute are architected:</p>

<ul>
  <li><strong>version</strong> – A version range. If a single version is given it will be used as <code class="language-shell highlighter-rouge"><span class="o">[</span>&lt;version&gt;,∞<span class="o">)</span></code>. The version range can be prefixed with an <code class="language-shell highlighter-rouge">@</code> for a consumer range (to the next major) or a provider range (to the next minor) when the <code class="language-shell highlighter-rouge">@</code> is a suffix of the version. The range can restrict the augmentation to a limited set of bundles.</li>
  <li><strong>capability:</strong> – The <code class="language-shell highlighter-rouge">capability:</code> directive specifies a Provide-Capability instruction, this will therefore likely have to be quoted to not confuse bnd with embedded comma’s. Any number of clauses can be specified in a capability directive by separating the clauses with a comma. (This is where the syntax gets stretched.)</li>
  <li><strong>requirement:</strong> – The <code class="language-shell highlighter-rouge">requirement:</code> directive specifies a Require-Capability instruction similar to the <code class="language-shell highlighter-rouge">capability:</code> directive.</li>
</ul>

<p>To augment the repositories during a resolve, bnd will find all bundles that match the bundle symbolic name and fall within the defined range. If no range is given, only the bundle symbolic name will constrain the search. Each found bundle will then be decorated with the capabilities and requirements defined in the <code class="language-shell highlighter-rouge">capability:</code> and <code class="language-shell highlighter-rouge">requirement:</code> directive.</p>

<p>For example, we need to provide an extender capability to a bundle with the bundle symbolic name <code class="language-shell highlighter-rouge">com.example.prime</code> with version <code class="language-shell highlighter-rouge"><span class="o">[</span>1.2,1.3<span class="o">)</span></code>. In that case add the following instruction to the <code class="language-shell highlighter-rouge">bndrun</code> file.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">-augment</span>.prime <span class="o">=</span> <span class="se">\</span>
      com.example.prime<span class="p">;</span> <span class="se">\</span>
           capability:<span class="o">=</span><span class="s1">'osgi.extender; \
                osgi.extender=some.extender; \
                version:Version=1.2@'</span>
</code></pre></div></div>

<p>The <code class="language-shell highlighter-rouge">capability:</code> and <code class="language-shell highlighter-rouge">requirement:</code> directives follow all the rules of the Provide-Capability and Require-Capability headers respectively. For the resolver, it is as if these headers were specified in their manifests. Since these headers can contain semicolons and commas they must be quoted. bnd will allow double quotes inside normal quotes and vice versa when it is necessary to nest quotes.</p>

<h2 id="first-time-curating-a-repository">First Time Curating a Repository</h2>

<p>A workspace setup with bnd will generally provide a good start. However, when you need to grandfather in a lot of bundles from Maven Central then it is likely that you will need to spend some time to augment these bundles. This can be a depressing task since you’ll find out how messy the world is. However, experience shows that once the repository is resolvable, maintaining it has very little overhead. Better, it tends to signal probems very early in the development process.</p>

<p>There are a number of (rudimentary) functions in the command line version of bnd that might be useful. Unfortunately, the commands currently assume an OSGi repository.</p>

<h2 id="resolving-against-existing-container">Resolving against existing container</h2>

<p>With openliberty, WebSphere Liberty, Karaf, Liferay, etc. you are deploying into an existing container which already has a lot of capabilities. The crux of the issue becomes resolving only what you need to deploy. What you need at that point is a way to find out what the container already provides in a format which can be used during resolve time.</p>

<p>Currently, the way to do that is to create a <strong>distro</strong> of the target container. This <strong>distro</strong> is a JAR file which provides all the capabilities that the target container provides at one point in time. It includes the capabilities of all currently installed bundles. It also contains all capabilities provided by the system bundle which may have been configured by framework properties. It is an aggregate view of all the capabilities available in the framework contained in a single JAR.</p>

<h2 id="resolving-multi-release-jar-files-mrj">Resolving Multi-Release JAR files (MRJ)</h2>

<p>A Multi-Release JAR (MRJ) has directories in <code class="language-shell highlighter-rouge">META-INF/versions/&lt;release&gt;</code> (see <a href="https://docs.oracle.com/en/java/javase/17/docs/specs/jar/jar.html#multi-release-jar-files">JAR File Specification</a>). When the JAR is deployed on a VM with a given release R, that VM will preferentially load file resource from its own release R and then down to the main area. This means that a JAR can have different content depending on the VM it is deployed. For OSGi, this means that a bundle resource can have different requirements based on the runtime VM. The capabilities are the same since the public API must not change.</p>

<p>The problem is that this makes some requirements dependent on the VM. To model this, we introduced synthetic resource for each supported VM release that can only resolve on that release and when the release specific requirements of the bundle can be resolved.</p>

<p>This is only about modeling a JAR as a resource in an OSGi repository. Nothing is changed in the original JAR.</p>

<p>So we first treat the <em>multi release</em> bundle as any other bundle when we turn it into a resource, the release directories are ignored. If there are none, we’re actually done.</p>

<p>Otherwise, we add a single requirement to a <code class="language-shell highlighter-rouge">bnd.multirelease</code> capability unique for this bundle. This namespace only has the properties <code class="language-shell highlighter-rouge">bnd.multirelease<span class="o">=</span>&lt;bsn&gt;</code> and <code class="language-shell highlighter-rouge"><span class="nv">version</span><span class="o">=</span>&lt;version&gt;</code>. By requiring another resource, we can generate a synthetic resource for each VM release that the bundle supports. This is depicted here, where mrj is <code class="language-shell highlighter-rouge">bnd.multirelease</code>.</p>

<p><img style="width: 600px" src="/releases/7.2.0/img/resolving-mrj.png" /></p>

<p>For the <code class="language-shell highlighter-rouge">osgi.identity</code> capability, we have to create a resource name that is unique. To keep it readable, the name is the <code class="language-shell highlighter-rouge">original-bsn + <span class="s2">"__"</span> + release</code>. The version is the original bundle’s version. We introduced a new type for these synthetic resources: <code class="language-shell highlighter-rouge">bnd.synthetic</code>.</p>

<p>A Bundle <code class="language-shell highlighter-rouge">x.y.z</code>, providing code for JDK 1.8, 9 and 11 will appear as <code class="language-shell highlighter-rouge">x.y.z__8</code>, <code class="language-shell highlighter-rouge">x.y.z__9</code> and <code class="language-shell highlighter-rouge">x.y.z__11</code> with the corresponding narrow version ranges for their respective Java version.</p>

<p>We also add the requirements of the bundle if it would run on that release.
The synthetic resources are added to the same repository of the original bundle</p>

<p>For example the bundle <code class="language-shell highlighter-rouge">org.assertj:assertj-core:3.24.1</code> contains classes for Java 8 and Java 9. In the <a href="https://bndtools.org/manual/resolution-view.html">Resolution View</a> of bndtools it is shown with the following two capabilities for each Java version:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM: assertj-core__8 <span class="nv">version</span><span class="o">=</span>3.24.1 <span class="nb">type</span><span class="o">=</span>bnd.synthetic
bnd.multireleaseCapability from a supporting resource 0 part of Optional[assertj-core <span class="nv">version</span><span class="o">=</span>3.24.1]
<span class="p">;</span>
	bnd.multirelease <span class="o">=</span> assertj-core<span class="p">;</span>
	version <span class="o">=</span> 3.24.1
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM: assertj-core__9 <span class="nv">version</span><span class="o">=</span>3.24.1 <span class="nb">type</span><span class="o">=</span>bnd.synthetic
bnd.multireleaseCapability from a supporting resource 1 part of Optional[assertj-core <span class="nv">version</span><span class="o">=</span>3.24.1]
<span class="p">;</span>
	bnd.multirelease <span class="o">=</span> assertj-core<span class="p">;</span>
	version <span class="o">=</span> 3.24.1
</code></pre></div></div>

<h3 id="how-do-you-create-a-distro">How do you create a distro?</h3>

<ol>
  <li>Install the <a href="https://search.maven.org/artifact/biz.aQute.bnd/biz.aQute.remote.agent">bnd remote agent bundle</a> in the target container runtime. This will automatically open a local socket on a default port used by the bnd cli next.</li>
  <li>
    <p>Execute the following command using the <a href="https://search.maven.org/artifact/biz.aQute.bnd/biz.aQute.bnd">bnd cli</a>:</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> bnd remote distro <span class="nt">-o</span> container-5.6.7.jar container 5.6.7
</code></pre></div>    </div>
  </li>
  <li>Take the jar <code class="language-shell highlighter-rouge">container-5.6.7.jar</code> created in 2. and place it into the directory containing the bndrun file that is used to resolve your deployment jars.</li>
  <li>
    <p>in the bndrun file add:</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">-distro</span>: <span class="k">${</span><span class="p">.</span><span class="k">}</span>/container-5.6.7.jar<span class="p">;</span><span class="nv">version</span><span class="o">=</span>file
</code></pre></div>    </div>
  </li>
  <li>resolve… the result of the resolve should be the set of bundles you need to install in the container, minus everything the container already provides.</li>
</ol>

<p>What you do with those resolved bundles is dependent on the goal of the developer. They can be directly installed in the existing container, or they could be assembled into a package format native to the container, or possibly a subsystem.</p>

<h3 id="considerations">Considerations</h3>
<p>What you need to bear in mind is that the <strong>distro</strong> needs to be re-created each time the target container changes in any significant way, otherwise it won’t reflect the true capabilities of the system needed to resolve against.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Creating applications from reusable models is a goal that the software industry has been trying to achieve for a long time. To a certain extent, the Maven dependency model provides this model. However, it also is a model where dependencies are not strictly managed and much is left to chance.</p>

<p>The resolver model provides an alternative (working inside maven if so desired) to establish a class path that optimises the whole application class path instead of just slavishly following transitively dependencies. Experience shows that organisations that use the resolver have a much better grip of what is actually running in their runtime. Not only minimises this runtime errors, it generally also makes it easier to migrate and evolve the code base.</p>

<p>Converting an existing build into a resolve based build can be daunting but the efforts are worth it. For bnd users that use the workspace model the advantages will flow freely.</p>


				</main>
			</div>
	</ul>




	
<footer class="container12" style="border-top: 1px solid black;padding:10px 0">
	<div class="container-right">
		<nav class="next-prev" data-pagefind-ignore>
     
    <a href='/releases/7.2.0/chapters/240-spi-annotations.html' title="SPI Annotations">Prev</a> 
     
    
    <a href='/releases/7.2.0/chapters/300-launching.html' title="Launching">Next</a>
     
</nav>
	</div>

	<div class="modal" id="searchmodal" aria-hidden="true">
    <div class="modal_overlay" tabindex="-1">
        <div class="modal_container" role="dialog" aria-modal="true">
            <header class="modal_header" style="margin-bottom: 10px;">
                <b>
                    Search
                    <button class="modal_btn modal_btn-primary" data-modal-close=""
                        aria-label="Close this dialog window" style="float:right;">Close</button>
                </b>
            </header>
            <main class="modal_content" id="modalcontent">
                <div id="pagefindsearch"></div>
            </main>
            <footer class="modal_footer">

            </footer>
        </div>
    </div>
</div>

<style>
    /* Basic styling to hide/show the modal */
    .modal {
        display: none;
        /* Hidden by default */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }

    /* Container for modal content */
    .modal_container {
        background: #fff;
        margin: 5% auto;
        /* Position the box somewhat centered */
        padding: 1rem;
        max-width: 600px;
        border-radius: 4px;
        position: relative;

        /* Height and overflow for scrolling */
        max-height: 80vh;
        /* Use 80% of the viewport height */
        overflow-y: auto;
        /* Enable scrolling within the modal */
    }

    /* When modal is open, display it */
    .modal.is-open {
        display: block;
    }
</style>

<script type="text/javascript">
    // Function to open the modal
    function openModal() {
        const modal = document.getElementById('searchmodal');
        // Change aria-hidden to false
        modal.setAttribute('aria-hidden', 'false');
        // Add a class to make it visible (assuming CSS uses .is-open to show)
        modal.classList.add('is-open');

        const searchFieldInput = document.querySelector('#modalcontent input');
        searchFieldInput.focus();

        // Define an event listener for the ESC key
        escapeKeyListener = function (event) {
            if (event.key === 'Escape' || event.key === 'Esc') {
                closeModal(modal);
            }
        };

        // Attach the ESC key event listener
        document.addEventListener('keydown', escapeKeyListener);

        // Attach click event listeners to close triggers
        attachCloseEvents(modal);
    }

    function attachCloseEvents(modal) {
        // Get all elements that can close the modal (overlay and close button)
        const closeElements = modal.querySelectorAll('[data-modal-close]');

        closeElements.forEach(el => {
            el.addEventListener('click', function handleClose() {
                closeModal(modal);
                // Remove this event listener once closed (cleanup)
                el.removeEventListener('click', handleClose);
            });
        });
    }

    // Function to close the modal
    function closeModal(modal) {
        modal.setAttribute('aria-hidden', 'true');
        modal.classList.remove('is-open');
    }
</script>



<link href="/releases/7.2.0/pagefindindex/pagefind-ui.css" rel="stylesheet">
<script src="/releases/7.2.0/pagefindindex/pagefind-ui.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({
            element: "#pagefindsearch",
            showSubResults: true,
            translations: {
                placeholder: "Search the bnd manual",
            },
            openFilters: ['pagetype']

        });
    });
</script>

	<ul span=12 row>
		<li span=12>
			<ul>
				<li><a href="/releases/7.2.0/">Home</a>
			</ul>
	</ul>

	<script type="text/javascript">
		document.addEventListener('DOMContentLoaded', () => {
			const headers = document.querySelectorAll('h1[id], h2[id], h3[id], h4[id]');

			headers.forEach(header => {
				const iconLink = document.createElement('a');
				iconLink.href = `#${header.id}`;
				iconLink.innerHTML = '#';
				iconLink.className = 'header-link';

				// Wrap the icon inside a span to control visibility with CSS
				const wrapper = document.createElement('span');
				wrapper.className = 'header-link-wrapper';
				wrapper.appendChild(iconLink);

				// Append the wrapper to the header
				header.appendChild(wrapper);
			});
		});


		// copy to clipboard buttons

		const copyButtonLabel = "Copy";
		let blocks = document.querySelectorAll("pre.highlight");

		blocks.forEach((block) => {
		// only add button if browser supports Clipboard API
		if (navigator.clipboard) {
			let button = document.createElement("button");
			button.classList.add("copycodebtn");

			button.innerText = copyButtonLabel;
			block.appendChild(button);

			button.addEventListener("click", async () => {
			await copyCode(block, button);
			});

		}
		});

		async function copyCode(block, button) {
		let code = block.querySelector("code");
		let text = code.innerText;

		await navigator.clipboard.writeText(text);

		button.innerText = "Copied";

			setTimeout(()=> {
				button.innerText = copyButtonLabel;
			},2000)
		}
	</script>

</footer>

</body>
</html>
