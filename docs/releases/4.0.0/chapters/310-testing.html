<!DOCTYPE html>
<html lang="en" ng-app="jpm">

	<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="/releases/4.0.0/css/style.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="/js/releases.js"></script>
<!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Testing</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Testing" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This section describes how bnd implements a pluggable testing framework. With most tools that use bnd this information is hidden behind a pleasant GUI (sometimes). However, in certain cases it is necessary to understand how bnd handles testing." />
<meta property="og:description" content="This section describes how bnd implements a pluggable testing framework. With most tools that use bnd this information is hidden behind a pleasant GUI (sometimes). However, in certain cases it is necessary to understand how bnd handles testing." />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-10-12T20:27:56-04:00" />
<script type="application/ld+json">
{"datePublished":"2019-10-12T20:27:56-04:00","description":"This section describes how bnd implements a pluggable testing framework. With most tools that use bnd this information is hidden behind a pleasant GUI (sometimes). However, in certain cases it is necessary to understand how bnd handles testing.","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"/releases/4.0.0/chapters/310-testing.html"},"url":"/releases/4.0.0/chapters/310-testing.html","headline":"Testing","dateModified":"2019-10-12T20:27:56-04:00","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->





































		<style>
			 body {
				counter-reset: h1 18;
			}
		</style>




































</head>


<body>


<ul class="container12 menu-bar">
	<li span=11><a class=menu-link href="/releases/4.0.0/"><img
			class=menu-logo src='/releases/4.0.0/img/bnd-80x40-white.png'></a>
			<a href="/releases/4.0.0/chapters/110-introduction.html">Intro
			</a><a href="/releases/4.0.0/chapters/800-headers.html">Headers
			</a><a href="/releases/4.0.0/chapters/820-instructions.html">Instructions
			</a><a href="/releases/4.0.0/chapters/850-macros.html">Macros
			</a><div class="releases"><button class="dropbtn">4.0.0</button><div class="dropdown-content"></div></div>

	<li class=menu-link span=1>
			<a href="https://github.com/bndtools/bnd" target="_"><img
	style="position:absolute;top:0;right:0;margin:0;padding:0;z-index:100"
	src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67"
	alt="Fork me on GitHub"
	data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
</ul>




	<ul class=container12>
		<li span=3>
			<div>
			<ul class="side-nav">


			<li><a href="/releases/4.0.0/chapters/100-release.html">Release</a>



			<li><a href="/releases/4.0.0/chapters/110-introduction.html">Introduction</a>



			<li><a href="/releases/4.0.0/chapters/120-install.html">How to install bnd</a>



			<li><a href="/releases/4.0.0/chapters/123-tour-workspace.html">Guided Tour</a>



			<li><a href="/releases/4.0.0/chapters/125-tour-features.html">Guided Tour Workspace & Projects</a>



			<li><a href="/releases/4.0.0/chapters/130-concepts.html">Concepts</a>



			<li><a href="/releases/4.0.0/chapters/140-best-practices.html">Best practices</a>



			<li><a href="/releases/4.0.0/chapters/150-build.html">Build</a>



			<li><a href="/releases/4.0.0/chapters/160-jars.html">Generating JARs</a>



			<li><a href="/releases/4.0.0/chapters/170-versioning.html">Versioning</a>



			<li><a href="/releases/4.0.0/chapters/180-baselining.html">Baselining</a>



			<li><a href="/releases/4.0.0/chapters/200-components.html">Service Components</a>



			<li><a href="/releases/4.0.0/chapters/210-metatype.html">Metatype</a>



			<li><a href="/releases/4.0.0/chapters/220-contracts.html">Contracts</a>



			<li><a href="/releases/4.0.0/chapters/230-manifest-annotations.html">Manifest Annotations</a>



			<li><a href="/releases/4.0.0/chapters/250-resolving.html">Resolving Dependencies</a>



			<li><a href="/releases/4.0.0/chapters/300-launching.html">Launching</a>



			<li class=selected>Testing



			<li><a href="/releases/4.0.0/chapters/320-packaging.html">Packaging Applications</a>



			<li><a href="/releases/4.0.0/chapters/390-wrapping.html">Wrapping Libraries to OSGi Bundles</a>



			<li><a href="/releases/4.0.0/chapters/400-commandline.html">From the command line</a>



			<li><a href="/releases/4.0.0/chapters/600-developer.html">For Developers</a>



			<li><a href="/releases/4.0.0/chapters/610-plugin.html">Plugins</a>



			<li><a href="/releases/4.0.0/chapters/700-tools.html">Tools bound to bnd</a>



			<li><a href="/releases/4.0.0/chapters/790-format.html">File Format</a>



			<li><a href="/releases/4.0.0/chapters/800-headers.html">Header Reference</a>



			<li><a href="/releases/4.0.0/chapters/820-instructions.html">Instruction</a>



			<li><a href="/releases/4.0.0/chapters/825-instructions-ref.html">Instruction Index</a>



			<li><a href="/releases/4.0.0/chapters/850-macros.html">Macro Reference</a>



			<li><a href="/releases/4.0.0/chapters/860-commands.html">Command Reference</a>



			<li><a href="/releases/4.0.0/chapters/870-plugins.html">Plugins Reference</a>



			<li><a href="/releases/4.0.0/chapters/880-settings.html">Settings</a>



			<li><a href="/releases/4.0.0/chapters/900-errors.html">Errors</a>



			<li><a href="/releases/4.0.0/chapters/910-warnings.html">Warnings</a>



			<li><a href="/releases/4.0.0/chapters/920-faq.html">Frequently Asked Questions</a>


</ul>

			<div class=enroute><a href="https://enroute.osgi.org">Supported by OSGi enRoute <img src="/releases/4.0.0/img/EnRouteIcon_CMYK.png"></a></div>
			</div>

		<li span=9>
			<div class=notes-margin>
				<h1> Testing</h1>
				<p>This section describes how bnd implements a pluggable testing framework. With most tools that use bnd this information is hidden behind a pleasant GUI (sometimes). However, in certain cases it is necessary to understand how bnd handles testing.</p>

<h2 id="model">Model</h2>
<p>In the classic way testing consists of launching a new VM, dynamically loading the classes to be tested and then running the test framework on those. As this violates module boundaries as if they did not exist there is another way.</p>

<p>In bnd there is a header that allows a bundle to define what tests it contains:</p>

<p>Test-Cases ::= fqn+</p>

<p>Such a bundle therefore exports a number of test cases to the environment. These test cases can then be executed by the tester. The default tester in bnd is the biz.aQute.junit bundle, but this can be overridden because the launcher and the tester are pluggable.</p>

<p>The default tester can run in ‘‘one shot’’ mode or in ‘‘automatic’’ mode. The one shot mode is used in build tools to fire a test and parse the result. In this mode, the build tool provides the class names to test.</p>

<p>In automatic mode, the default tester creates a list of available bundles with test cases and executes all of them. Automatic mode can then end or it can run in continuous mode. Every time a bundle is started it will run the tests again. Continuous mode is intended for developing test bundles. You just run a framework and edit your test bundle’s code. Any changes are saved and deployed, triggering the tests.</p>

<h2 id="framework-properties-for-the-default-tester">Framework Properties for the Default Tester</h2>
<p>The default tester uses the project information to parameterize the tester’s runtime component. However, it is also possible to set these runtime parameters explicitly with framework properties when you want to run the framework in automatic mode. The default tester obeys the following framework properties:</p>

<table>
  <tbody>
    <tr>
      <td>!Property</td>
      <td>!Default</td>
      <td>!Description</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">tester.port</code></td>
      <td>-</td>
      <td>The port to send the JUnit information to in a format defined by Eclipse. If this property is not set, no information is send but tests are still run.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">tester.host</code></td>
      <td><code class="highlighter-rouge">localhost</code></td>
      <td>The host to send the JUnit information to in a formatted defined by Eclipse. If this property is not set localhost is assumed.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">tester.names</code></td>
      <td> </td>
      <td>Fully qualified names of classes to test. If this property is <code class="highlighter-rouge">null</code> automatic mode is chosen, otherwise these classes are going to be tested and then the test ends.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">tester.dir</code></td>
      <td><code class="highlighter-rouge">testdir</code></td>
      <td>A directory to put the test reports. If the directory does not exist, no reports are generated. The default is <code class="highlighter-rouge">testdir</code> in the default directory. This directory is not automatically created so to see the results it is necessary to ensure such a directory exists. the files in the test directory are usable in Hudson/Jenkins as test reports</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">tester.continuous</code></td>
      <td><code class="highlighter-rouge">false</code></td>
      <td>In automatic mode, no <code class="highlighter-rouge">tester.names</code> set, continue watching the bundles and re-run a bundle’s tests when it is started.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">tester.trace</code></td>
      <td><code class="highlighter-rouge">false</code></td>
      <td>Trace the test framework in detail. Default is false, must be set to true or false.</td>
    </tr>
  </tbody>
</table>

<h2 id="how-to-set-the-test-cases-macro-automatically">How to set the Test-Cases Macro Automatically</h2>
<p>The Test-Cases macro can be set by hand but this can become a maintenance nightmare. A very useful macro is the <code class="highlighter-rouge">${classes}</code> macro. This macro inspects the JAR and can find all classes that are considered test cases:</p>

<p>Test-Cases = ${classes;CONCRETE;EXTENDS;junit.framework.TestCase}</p>

<p>This example looks for concrete classes that somehow extend the junit base class.</p>

<h2 id="continuous-testing">Continuous Testing</h2>
<p>To setup an environment to test continuously, the following launcher can be used:</p>

<p>Test-Cases: ${classes;CONCRETE;EXTENDS;junit.framework.TestCase}
  -runfw: org.apache.felix.framework
  -buildpath: osgi.core;version=[4.1’,’5), \
	osgi.cmpn,  \
	junit.osgi
  Private-Package: org.example.tests
  -runtrace: true
  -runbundles: biz.aQute.junit
  -runproperties:  \
        tester.trace=true, \
	tester.continuous=true, \
	tester.dir=testdir</p>

<p>The example setup creates a bundle containing the org.example.tests package and sets the <code class="highlighter-rouge">Test-Cases</code> header to all testcases in that package. If you run this setup, it runs the project bundle with the biz.aQute.junit bundle. This tester bundle is parametrized with the <code class="highlighter-rouge">tester.*</code> properties to have trace on, test continuous, and put the test reports in <code class="highlighter-rouge">./testdir</code>.</p>

<p>You can find a bndtools project that shows this at <a href="https://github.com/bnd/aQute/tree/master/aQute.testing">Github</a>.</p>

<h2 id="other-tester-frameworks">Other Tester Frameworks</h2>
<p>The biz.aQute.tester is a normal bundle that gets started from the launcher framework. However, before bnd chooses the default tester, it scans the classpath for a tester (set with <code class="highlighter-rouge">-runpath</code>) for JARs that have the following header set:</p>

  	Tester-Plugin ::= fqn

<p>If not such tester is found on the <code class="highlighter-rouge">-runpath</code> it will look in the <code class="highlighter-rouge">-tester</code> instruction and loads that bundle. If it still can find it, it will use <code class="highlighter-rouge">biz.aQute.tester</code>. If you set:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-tester				biz.aQute.junit
</code></pre></div></div>

<p>The <code class="highlighter-rouge">Tester-Plugin</code> header points to a class that must extend the <code class="highlighter-rouge">aQute.bnd.build.ProjectTester</code> class. This class is loaded in the bnd environment and not in the target environment. This ProjectTester plugin then gets a chance to configure the launcher as it sees fit. It can get properties from the project and set these in the Project Launcher so they can be picked up in the target environment.</p>

<p>As this is a quite specific area the rest of the documentation is found in the source code.</p>

<h2 id="older-versions">Older Versions</h2>

<p>For a long time bnd had <code class="highlighter-rouge">biz.aQute.junit</code> as the launcher, today it is <code class="highlighter-rouge">biz.aQute.tester</code>. This launcher added itself to the <code class="highlighter-rouge">-runpath</code> and then executed the tests from there. Unfortunately this required that the tester actually exported the JUnit packages. This caused constraints between JUnit and bnd that was not good because JUnit itself is not directly a shining example of software engineering :-(</p>

<p>If you want to be backward compatible with the older model, set:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-tester: biz.aQute.junit
</code></pre></div></div>

			</div>
	</ul>


<nav class=next-prev>
	<a href='/releases/4.0.0/chapters/300-launching.html'></a> <a href='/releases/4.0.0/chapters/320-packaging.html'></a>
</nav>
<footer class="container12" style="border-top: 1px solid black;padding:10px 0">
	<ul span=12 row>
		<li span=3>
			<ul>
				<li><a href="/releases/4.0.0/contact.html">Contact</a>
			</ul>
		<li span=3>
			<ul>
				<li><a href="/releases/4.0.0/">Developers</a>
			</ul>
		<li span=3>
			<ul>
				<li><a href="/releases/4.0.0/">More</a>
			</ul>
	</ul>
</footer>

</body>
</html>
