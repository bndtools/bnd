<?xml version="1.0" encoding="UTF-8"?>
<project name="project" default="build"> 
	<property name="workspacedir" value="../../.."/>
	<import file="${workspacedir}/cnf/build.xml"/>

	<macrodef name="subtest">
		<attribute name="lower"/>
		<attribute name="upper"/>
		<sequential>
			<delete file="launch.properties"/>
			<ant target="gen" inheritAll="false">
				<property name="genlaunchprop.source" value="@{lower}.bndrun"/>
			</ant>
			<exec executable="cmd" outputproperty="@{lower}.output">
				<arg value="/c"/>
				<arg value="run.bat"/>
			</exec>
			<echo message="@{lower}.output=${@{lower}.output}"/>
			<condition property="@{lower}.output.good">
				<equals arg1="${@{lower}.output}"
					arg2="Class@{upper} started"/>
			</condition>
			<echo message="@{lower}.output.good=${@{lower}.output.good}"/>
			<fail unless="@{lower}.output.good"/>
		</sequential>
	</macrodef>

	<target name="dotest">
		<subtest lower="a" upper="A"/>	
		<subtest lower="b" upper="B"/>	
	</target>
	
</project>
